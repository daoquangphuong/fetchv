/*! Project library from: https://github.com/video-dev/hls.js/ | https://github.com/tjenkinson/url-toolkit | https://github.com/videojs/m3u8-parser */
const CHROME=navigator.userAgent.includes("Chrome")?chrome:browser;!function(e){var t=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/\;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,s=/^([^\/;?#]*)(.*)$/,r=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,n={buildAbsoluteURL:function(e,t,r){if(r=r||{},e=e.trim(),!(t=t.trim())){if(!r.alwaysNormalize)return e;var a=n.parseURL(e);if(a)return a.path=n.normalizePath(a.path),n.buildURLFromParts(a);throw new Error("Error trying to parse base URL.")}a=n.parseURL(t);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return r.alwaysNormalize?(a.path=n.normalizePath(a.path),n.buildURLFromParts(a)):t;t=n.parseURL(e);if(!t)throw new Error("Error trying to parse base URL.");!t.netLoc&&t.path&&"/"!==t.path[0]&&(e=s.exec(t.path),t.netLoc=e[1],t.path=e[2]),t.netLoc&&!t.path&&(t.path="/");var i,e={scheme:t.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};return a.netLoc||(e.netLoc=t.netLoc,"/"!==a.path[0]&&(a.path?(i=(i=t.path).substring(0,i.lastIndexOf("/")+1)+a.path,e.path=n.normalizePath(i)):(e.path=t.path,a.params||(e.params=t.params,a.query||(e.query=t.query))))),null===e.path&&(e.path=r.alwaysNormalize?n.normalizePath(a.path):a.path),n.buildURLFromParts(e)},parseURL:function(e){e=t.exec(e);return e?{scheme:e[1]||"",netLoc:e[2]||"",path:e[3]||"",params:e[4]||"",query:e[5]||"",fragment:e[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(r,"");e.length!==(e=e.replace(a,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};"object"==typeof exports&&"object"==typeof module?module.exports=n:"function"==typeof define&&define.amd?define([],function(){return n}):"object"==typeof exports?exports.URLToolkit=n:e.URLToolkit=n}(this),function(E){const k={log:()=>{},error:()=>{},warn:()=>{},debug:()=>{},trace:()=>{}},O={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",LEVELS_UPDATED:"hlsLevelsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",CUES_PARSED:"hlsCuesParsed",NON_NATIVE_TEXT_TRACKS_FOUND:"hlsNonNativeTextTracksFound",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition",LIVE_BACK_BUFFER_REACHED:"hlsLiveBackBufferReached"};var F,N;(S=F=F||{}).NETWORK_ERROR="networkError",S.MEDIA_ERROR="mediaError",S.KEY_SYSTEM_ERROR="keySystemError",S.MUX_ERROR="muxError",S.OTHER_ERROR="otherError",(S=N=N||{}).KEY_SYSTEM_NO_KEYS="keySystemNoKeys",S.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",S.KEY_SYSTEM_NO_SESSION="keySystemNoSession",S.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",S.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",S.MANIFEST_LOAD_ERROR="manifestLoadError",S.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",S.MANIFEST_PARSING_ERROR="manifestParsingError",S.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",S.LEVEL_EMPTY_ERROR="levelEmptyError",S.LEVEL_LOAD_ERROR="levelLoadError",S.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",S.LEVEL_SWITCH_ERROR="levelSwitchError",S.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",S.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",S.FRAG_LOAD_ERROR="fragLoadError",S.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",S.FRAG_DECRYPT_ERROR="fragDecryptError",S.FRAG_PARSING_ERROR="fragParsingError",S.REMUX_ALLOC_ERROR="remuxAllocError",S.KEY_LOAD_ERROR="keyLoadError",S.KEY_LOAD_TIMEOUT="keyLoadTimeOut",S.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",S.BUFFER_APPEND_ERROR="bufferAppendError",S.BUFFER_APPENDING_ERROR="bufferAppendingError",S.BUFFER_STALLED_ERROR="bufferStalledError",S.BUFFER_FULL_ERROR="bufferFullError",S.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",S.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",S.INTERNAL_EXCEPTION="internalException";function r(e,t,r,a){e=e*t*(r=void 0===r?1:r);return(a=void 0===a?!1:a)?Math.round(e):e}function M(e,t){return r(e,1e3,1/9e4,t=void 0===t?!1:t)}function e(e,t){return r(e,9e4,1/(t=void 0===t?1:t))}const R=/^(\d+)x(\d+)$/,a=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g;class w{constructor(e){for(var t in e="string"==typeof e?w.parseAttrList(e):e)e.hasOwnProperty(t)&&(this[t]=e[t])}decimalInteger(e){e=parseInt(this[e],10);return e>Number.MAX_SAFE_INTEGER?1/0:e}hexadecimalInteger(e){if(this[e]){var t=(1&(t=(this[e]||"0x").slice(2)).length?"0":"")+t,r=new Uint8Array(t.length/2);for(let e=0;e<t.length/2;e++)r[e]=parseInt(t.slice(2*e,2*e+2),16);return r}return null}hexadecimalIntegerAsNumber(e){e=parseInt(this[e],16);return e>Number.MAX_SAFE_INTEGER?1/0:e}decimalFloatingPoint(e){return parseFloat(this[e])}enumeratedString(e){return this[e]}decimalResolution(e){e=R.exec(this[e]);if(null!==e)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}}static parseAttrList(e){var t,r={};for(a.lastIndex=0;null!==(t=a.exec(e));){let e=t[2];0===e.indexOf('"')&&e.lastIndexOf('"')===e.length-1&&(e=e.slice(1,-1)),r[t[1]]=e}return r}}var _={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};function t(){return"undefined"==typeof window?self:window}function s(e,t,r,a){let i,s,n,o,d,l="Android".toLowerCase(),u=a,h=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];if(i=1+((192&t[r+2])>>>6),s=(60&t[r+2])>>>2,!(h.length-1<s))return o=(1&t[r+2])<<2,o|=(192&t[r+3])>>>6,k.log(`manifest codec:${a},ADTS data:type:${i},sampleingIndex:${s}[${h[s]}Hz],channelConfig:`+o),n=/firefox/i.test(l)?6<=s?(i=5,d=new Array(4),s-3):(i=2,d=new Array(2),s):-1!==l.indexOf("android")?(i=2,d=new Array(2),s):(i=5,d=new Array(4),a&&(-1!==a.indexOf("mp4a.40.29")||-1!==a.indexOf("mp4a.40.5"))||!a&&6<=s?s-3:((a&&-1!==a.indexOf("mp4a.40.2")&&(6<=s&&1==o||/vivaldi/i.test(l))||!a&&1==o)&&(i=2,d=new Array(2)),s)),d[0]=i<<3,d[0]|=(14&s)>>1,d[1]|=(1&s)<<7,d[1]|=o<<3,5===i&&(d[1]|=(14&n)>>1,d[2]=(1&n)<<7,d[2]|=8,d[3]=0),{config:d,samplerate:h[s],channelCount:o,codec:"mp4a.40."+i,manifestCodec:u};e.trigger(O.ERROR,{type:F.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+s})}function i(e,t){return 255===e[t]&&240==(246&e[t+1])}function o(e,t){return 1&e[t+1]?7:9}function d(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function n(e,t){return!!(t+1<e.length&&i(e,t))}function l(e){return 9216e4/e}function u(e,t,r,a,i){var s=e.length,n=o(e,t),e=d(e,t);if(0<(e-=n)&&t+n+e<=s)return{headerLength:n,frameLength:e,stamp:r+a*i}}const m={getAudioConfig:s,isHeaderPattern:i,getHeaderLength:o,getFullFrameLength:d,isHeader:n,probe:function(e,t){if(n(e,t)){var r=o(e,t);if(t+r>=e.length)return!1;var a=d(e,t);if(a<=r)return!1;r=t+a;if(r===e.length||r+1<e.length&&i(e,r))return!0}return!1},initTrackConfig:function(e,t,r,a,i){e.samplerate||(t=s(t,r,a,i),e.config=t.config,e.samplerate=t.samplerate,e.channelCount=t.channelCount,e.codec=t.codec,e.manifestCodec=t.manifestCodec,k.log(`parsed codec:${e.codec},rate:${t.samplerate},nb channel:`+t.channelCount))},getFrameDuration:l,parseFrameHeader:u,appendFrame:function(e,t,r,a,i){var s;if(a=u(t,r,a,i,l(e.samplerate)))return i=a.stamp,s=a.headerLength,a=a.frameLength,t={unit:t.subarray(r+s,r+s+a),pts:i,dts:i},e.samples.push(t),{sample:t,length:a+s}}},f={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(e,t,r,a,i){var s;return!(r+24>t.length)&&(s=this.parseHeader(t,r))&&r+s.frameLength<=t.length?(a=a+i*(9e4*s.samplesPerFrame/s.sampleRate),i={unit:t.subarray(r,r+s.frameLength),pts:a,dts:a},e.config=[],e.channelCount=s.channelCount,e.samplerate=s.sampleRate,e.samples.push(i),{sample:i,length:s.frameLength}):void 0},parseHeader:function(e,t){var r,a=e[t+1]>>3&3,i=e[t+1]>>1&3,s=e[t+2]>>4&15,n=e[t+2]>>2&3,o=e[t+2]>>1&1;if(1!=a&&0!=s&&15!=s&&3!=n)return r=3==a?3-i:3==i?3:4,r=1e3*f.BitratesMap[14*r+s-1],s=3==a?0:2==a?1:2,s=f.SamplingRateMap[3*s+n],n=e[t+3]>>6==3?1:2,a=8*(e=f.SamplesCoefficients[a][i])*(t=f.BytesInSlot[i]),{sampleRate:s,channelCount:n,frameLength:parseInt(e*r/s+o,10)*t,samplesPerFrame:a}},isHeaderPattern:function(e,t){return 255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1])},isHeader:function(e,t){return!!(t+1<e.length&&this.isHeaderPattern(e,t))},probe:function(t,r){if(r+1<t.length&&this.isHeaderPattern(t,r)){var a=this.parseHeader(t,r);let e=4;r=r+(e=a&&a.frameLength?a.frameLength:e);if(r===t.length||r+1<t.length&&this.isHeaderPattern(t,r))return!0}return!1}};class T{constructor(e){this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){var e=this.data,t=this.bytesAvailable,r=e.byteLength-t,a=new Uint8Array(4),t=Math.min(4,t);if(0===t)throw new Error("no bytes available");a.set(e.subarray(r,r+t)),this.word=new DataView(a.buffer).getUint32(0),this.bitsAvailable=8*t,this.bytesAvailable-=t}skipBits(e){var t;this.bitsAvailable>e||(e=(e-=this.bitsAvailable)-((t=e>>3)>>3),this.bytesAvailable-=t,this.loadWord()),this.word<<=e,this.bitsAvailable-=e}readBits(e){var t=Math.min(this.bitsAvailable,e),r=this.word>>>32-t;return 32<e&&k.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,0<this.bitsAvailable?this.word<<=t:0<this.bytesAvailable&&this.loadWord(),0<(t=e-t)&&this.bitsAvailable?r<<t|this.readBits(t):r}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){var e=this.skipLZ();return this.readBits(e+1)-1}readEG(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(e){let t=8,r=8,a,i;for(a=0;a<e;a++)0!==r&&(i=this.readEG(),r=(t+i+256)%256),t=0===r?t:r}readSPS(){let e=0,t=0,r=0,a=0,i,s,n,o,d,l,u,h=this.readUByte.bind(this),c=this.readBits.bind(this),p=this.readUEG.bind(this),m=this.readBoolean.bind(this),f=this.skipBits.bind(this),g=this.skipEG.bind(this),y=this.skipUEG.bind(this),A=this.skipScalingList.bind(this);if(h(),i=h(),c(5),f(3),h(),y(),100===i||110===i||122===i||244===i||44===i||83===i||86===i||118===i||128===i){var v=p();if(3===v&&f(1),y(),y(),f(1),m())for(l=3!==v?8:12,u=0;u<l;u++)m()&&(u<6?A(16):A(64))}y();v=p();if(0===v)p();else if(1===v)for(f(1),g(),g(),s=p(),u=0;u<s;u++)g();y(),f(1),n=p(),o=p(),0===(d=c(1))&&f(1),f(1),m()&&(e=p(),t=p(),r=p(),a=p());let S=[1,1];if(m()&&m())switch(h()){case 1:S=[1,1];break;case 2:S=[12,11];break;case 3:S=[10,11];break;case 4:S=[16,11];break;case 5:S=[40,33];break;case 6:S=[24,11];break;case 7:S=[20,11];break;case 8:S=[32,11];break;case 9:S=[80,33];break;case 10:S=[18,11];break;case 11:S=[15,11];break;case 12:S=[64,33];break;case 13:S=[160,99];break;case 14:S=[4,3];break;case 15:S=[3,2];break;case 16:S=[2,1];break;case 255:S=[h()<<8|h(),h()<<8|h()]}return{width:Math.ceil(16*(n+1)-2*e-2*t),height:(2-d)*(o+1)*16-(d?2:4)*(r+a),pixelRatio:S}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class D{constructor(e,t){this.subtle=e,this.aesIV=t}decrypt(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}}class I{constructor(e,t){this.subtle=e,this.key=t}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}function H(e){var t=e.byteLength,r=t&&new DataView(e).getUint8(t-1);return r?e.slice(0,t-r):e}class U{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}uint8ArrayToUint32Array_(e){var t=new DataView(e),r=new Uint32Array(4);for(let e=0;e<4;e++)r[e]=t.getUint32(4*e);return r}initTable(){var e=this.sBox,t=this.invSBox,r=this.subMix,a=r[0],i=r[1],s=r[2],n=r[3],r=this.invSubMix,o=r[0],d=r[1],l=r[2],u=r[3],h=new Uint32Array(256);let c=0,p=0,m=0;for(m=0;m<256;m++)m<128?h[m]=m<<1:h[m]=m<<1^283;for(m=0;m<256;m++){var f=(f=p^p<<1^p<<2^p<<3^p<<4)>>>8^255&f^99,g=h[t[e[c]=f]=c],y=h[g],A=h[y],v=257*h[f]^16843008*f;a[c]=v<<24|v>>>8,i[c]=v<<16|v>>>16,s[c]=v<<8|v>>>24,n[c]=v,v=16843009*A^65537*y^257*g^16843008*c,o[f]=v<<24|v>>>8,d[f]=v<<16|v>>>16,l[f]=v<<8|v>>>24,u[f]=v,c?(c=g^h[h[h[A^g]]],p^=h[h[p]]):c=p=1}}expandKey(i){var s=this.uint8ArrayToUint32Array_(i);let e=!0,t=0;for(;t<s.length&&e;)e=s[t]===this.key[t],t++;if(!e){this.key=s;var n=this.keySize=s.length;if(4!==n&&6!==n&&8!==n)throw new Error("Invalid aes key size="+n);var o=this.ksRows=4*(n+6+1);let e,t;var d=this.keySchedule=new Uint32Array(o),l=this.invKeySchedule=new Uint32Array(o),u=this.sBox,h=this.rcon,i=this.invSubMix,c=i[0],p=i[1],m=i[2],f=i[3];let r,a;for(e=0;e<o;e++)e<n?r=d[e]=s[e]:(a=r,e%n==0?(a=u[(a=a<<8|a>>>24)>>>24]<<24|u[a>>>16&255]<<16|u[a>>>8&255]<<8|u[255&a],a^=h[e/n|0]<<24):6<n&&e%n==4&&(a=u[a>>>24]<<24|u[a>>>16&255]<<16|u[a>>>8&255]<<8|u[255&a]),d[e]=r=(d[e-n]^a)>>>0);for(t=0;t<o;t++)e=o-t,a=3&t?d[e]:d[e-4],t<4||e<=4?l[t]=a:l[t]=c[u[a>>>24]]^p[u[a>>>16&255]]^m[u[a>>>8&255]]^f[u[255&a]],l[t]=l[t]>>>0}}networkToHostOrderSwap(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}decrypt(e,t,r,a){var i=this.keySize+6,s=this.invKeySchedule,n=this.invSBox,o=this.invSubMix,d=o[0],l=o[1],u=o[2],h=o[3],o=this.uint8ArrayToUint32Array_(r);let c=o[0],p=o[1],m=o[2],f=o[3];var g,y,A,v,S=new Int32Array(e),b=new Int32Array(S.length);let T,E,R,_,D,I,U,w,C,x;for(var P=this.networkToHostOrderSwap;t<S.length;){for(g=P(S[t]),y=P(S[t+1]),A=P(S[t+2]),v=P(S[t+3]),D=g^s[0],I=v^s[1],U=A^s[2],w=y^s[3],C=4,x=1;x<i;x++)T=d[D>>>24]^l[I>>16&255]^u[U>>8&255]^h[255&w]^s[C],E=d[I>>>24]^l[U>>16&255]^u[w>>8&255]^h[255&D]^s[C+1],R=d[U>>>24]^l[w>>16&255]^u[D>>8&255]^h[255&I]^s[C+2],_=d[w>>>24]^l[D>>16&255]^u[I>>8&255]^h[255&U]^s[C+3],D=T,I=E,U=R,w=_,C+=4;T=n[D>>>24]<<24^n[I>>16&255]<<16^n[U>>8&255]<<8^n[255&w]^s[C],E=n[I>>>24]<<24^n[U>>16&255]<<16^n[w>>8&255]<<8^n[255&D]^s[C+1],R=n[U>>>24]<<24^n[w>>16&255]<<16^n[D>>8&255]<<8^n[255&I]^s[C+2],_=n[w>>>24]<<24^n[D>>16&255]<<16^n[I>>8&255]<<8^n[255&U]^s[C+3],C+=3,b[t]=P(T^c),b[t+1]=P(_^p),b[t+2]=P(R^m),b[t+3]=P(E^f),c=g,p=y,m=A,f=v,t+=4}return a?H(b.buffer):b.buffer}destroy(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0}}const z=t();class K{constructor(e,t,{removePKCS7Padding:r=!0}={}){if(this.logEnabled=!0,this.observer=e,this.config=t,this.removePKCS7Padding=r)try{var a=z.crypto;a&&(this.subtle=a.subtle||a.webkitSubtle)}catch(e){}this.disableWebCrypto=!this.subtle}isSync(){return this.disableWebCrypto&&this.config.enableSoftwareAES}decrypt(t,r,a,i){if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(k.log("JS AES decrypt"),this.logEnabled=!1);let e=this.decryptor;e||(this.decryptor=e=new U),e.expandKey(r),i(e.decrypt(t,0,a,this.removePKCS7Padding))}else{this.logEnabled&&(k.log("WebCrypto AES decrypt"),this.logEnabled=!1);const s=this.subtle;this.key!==r&&(this.key=r,this.fastAesKey=new I(s,r)),this.fastAesKey.expandKey().then(e=>{new D(s,a).decrypt(t,e).catch(e=>{this.onWebCryptoError(e,t,r,a,i)}).then(e=>{i(e)})}).catch(e=>{this.onWebCryptoError(e,t,r,a,i)})}}onWebCryptoError(e,t,r,a,i){this.config.enableSoftwareAES?(k.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(t,r,a,i)):(k.error("decrypting error : "+e.message),this.observer.trigger(O.ERROR,{type:F.MEDIA_ERROR,details:N.FRAG_DECRYPT_ERROR,fatal:!0,reason:e.message}))}destroy(){var e=this.decryptor;e&&(e.destroy(),this.decryptor=void 0)}}class X{constructor(e,t,r,a){this.decryptdata=r,this.discardEPB=a,this.decrypter=new K(e,t,{removePKCS7Padding:!1})}decryptBuffer(e,t){this.decrypter.decrypt(e,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,t)}decryptAacSample(t,r,a,i){let s=t[r].unit;var e=s.subarray(16,s.length-s.length%16),e=e.buffer.slice(e.byteOffset,e.byteOffset+e.length);let n=this;this.decryptBuffer(e,function(e){e=new Uint8Array(e),s.set(e,16),i||n.decryptAacSamples(t,r+1,a)})}decryptAacSamples(e,t,r){for(;;t++){if(t>=e.length)return void r();if(!(e[t].unit.length<32)){var a=this.decrypter.isSync();if(this.decryptAacSample(e,t,r,a),!a)return}}}getAvcEncryptedData(t){var e=16*Math.floor((t.length-48)/160)+16,r=new Int8Array(e);let a=0;for(let e=32;e<=t.length-16;e+=160,a+=16)r.set(t.subarray(e,e+16),a);return r}getAvcDecryptedUnit(t,r){r=new Uint8Array(r);let a=0;for(let e=32;e<=t.length-16;e+=160,a+=16)t.set(r.subarray(a,a+16),e);return t}decryptAvcSample(t,r,a,i,s,n){let o=this.discardEPB(s.data);var e=this.getAvcEncryptedData(o);let d=this;this.decryptBuffer(e.buffer,function(e){s.data=d.getAvcDecryptedUnit(o,e),n||d.decryptAvcSamples(t,r,a+1,i)})}decryptAvcSamples(e,t,r,a){for(;;t++,r=0){if(t>=e.length)return void a();for(var i=e[t].units;!(r>=i.length);r++){var s=i[r];if(!(s.length<=48||1!==s.type&&5!==s.type)){var n=this.decrypter.isSync();if(this.decryptAvcSample(e,t,r,a,s,n),!n)return}}}}}const Y={video:1,audio:2,id3:3,text:4};class x{constructor(e,t,r,a){this.observer=e,this.config=r,this.typeSupported=a,this.remuxer=t,this.sampleAes=null,this.pmtUnknownTypes={}}setDecryptData(e){null!=e&&null!=e.key&&"SAMPLE-AES"===e.method?this.sampleAes=new X(this.observer,this.config,e,this.discardEPB):this.sampleAes=null}static probe(e){e=x._syncOffset(e);return!(e<0)&&(e&&k.warn(`MPEG2-TS detected but first sync word found @ offset ${e}, junk ahead ?`),!0)}static _syncOffset(e){var t=Math.min(1e3,e.length-564);let r=0;for(;r<t;){if(71===e[r]&&71===e[r+188]&&71===e[r+376])return r;r++}return-1}static createTrack(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:Y[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:"video"===e?0:void 0,isAAC:"audio"===e||void 0,duration:"audio"===e?t:void 0}}resetInitSegment(e,t,r,a){this.pmtParsed=!1,this._pmtId=-1,this.pmtUnknownTypes={},this._avcTrack=x.createTrack("video",a),this._audioTrack=x.createTrack("audio",a),this._id3Track=x.createTrack("id3",a),this._txtTrack=x.createTrack("text",a),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=t,this.videoCodec=r,this._duration=a}resetTimeStamp(){}append(e,t,r,a){let i,s=e.length,n,o,d,l,u=!1,h=(this.pmtUnknownTypes={},this.contiguous=r,this.pmtParsed),c=this._avcTrack,p=this._audioTrack,m=this._id3Track,f=c.pid,g=p.pid,y=m.pid,A=this._pmtId,v=c.pesData,S=p.pesData,b=m.pesData,T=this._parsePAT,E=this._parsePMT.bind(this),R=this._parsePES,_=this._parseAVCPES.bind(this),D=this._parseAACPES.bind(this),I=this._parseMPEGPES.bind(this),U=this._parseID3PES.bind(this);var w=x._syncOffset(e);for(s-=(s+w)%188,i=w;i<s;i+=188)if(71===e[i]){if(n=!!(64&e[i+1]),o=((31&e[i+1])<<8)+e[i+2],1<(48&e[i+3])>>4){if((d=i+5+e[i+4])===i+188)continue}else d=i+4;switch(o){case f:n&&(v&&(l=R(v))&&_(l,!1),v={data:[],size:0}),v&&(v.data.push(e.subarray(d,i+188)),v.size+=i+188-d);break;case g:n&&(S&&(l=R(S))&&(p.isAAC?D:I)(l),S={data:[],size:0}),S&&(S.data.push(e.subarray(d,i+188)),S.size+=i+188-d);break;case y:n&&(b&&(l=R(b))&&U(l),b={data:[],size:0}),b&&(b.data.push(e.subarray(d,i+188)),b.size+=i+188-d);break;case 0:n&&(d+=e[d]+1),A=this._pmtId=T(e,d);break;case A:n&&(d+=e[d]+1);var C=E(e,d,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);0<(f=C.avc)&&(c.pid=f),0<(g=C.audio)&&(p.pid=g,p.isAAC=C.isAAC),0<(y=C.id3)&&(m.pid=y),u&&!h&&(k.log("reparse from beginning"),u=!1,i=w-188),h=this.pmtParsed=!0;break;case 17:case 8191:break;default:u=!0}}else this.observer.trigger(O.ERROR,{type:F.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});v&&(l=R(v))?(_(l,!0),c.pesData=null):c.pesData=v,S&&(l=R(S))?((p.isAAC?D:I)(l),p.pesData=null):(S&&S.size&&k.log("last AAC PES packet truncated,might overlap between fragments"),p.pesData=S),b&&(l=R(b))?(U(l),m.pesData=null):m.pesData=b,null==this.sampleAes?this.remuxer.remux(p,c,m,this._txtTrack,t,r,a):this.decryptAndRemux(p,c,m,this._txtTrack,t,r,a)}decryptAndRemux(t,r,a,i,s,n,o){if(t.samples&&t.isAAC){let e=this;this.sampleAes.decryptAacSamples(t.samples,0,function(){e.decryptAndRemuxAvc(t,r,a,i,s,n,o)})}else this.decryptAndRemuxAvc(t,r,a,i,s,n,o)}decryptAndRemuxAvc(t,r,a,i,s,n,o){if(r.samples){let e=this;this.sampleAes.decryptAvcSamples(r.samples,0,0,function(){e.remuxer.remux(t,r,a,i,s,n,o)})}else this.remuxer.remux(t,r,a,i,s,n,o)}destroy(){this._initPTS=this._initDTS=void 0,this._duration=0}_parsePAT(e,t){return(31&e[t+10])<<8|e[t+11]}_trackUnknownPmt(e,t,r){var a=this.pmtUnknownTypes[e]||0;return 0===a&&(this.pmtUnknownTypes[e]=0,t.call(k,r)),this.pmtUnknownTypes[e]++,a}_parsePMT(e,t,r,a){var i,s={audio:-1,avc:-1,id3:-1,isAAC:!0},n=t+3+((15&e[t+1])<<8|e[t+2])-4;for(t+=12+((15&e[t+10])<<8|e[t+11]);t<n;){switch(i=(31&e[t+1])<<8|e[t+2],e[t]){case 207:if(!a){this._trackUnknownPmt(e[t],k.warn,"ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===s.audio&&(s.audio=i);break;case 21:-1===s.id3&&(s.id3=i);break;case 219:if(!a){this._trackUnknownPmt(e[t],k.warn,"H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===s.avc&&(s.avc=i);break;case 3:case 4:r?-1===s.audio&&(s.audio=i,s.isAAC=!1):this._trackUnknownPmt(e[t],k.warn,"MPEG audio found, not supported in this browser");break;case 36:this._trackUnknownPmt(e[t],k.warn,"Unsupported HEVC stream type found");break;default:this._trackUnknownPmt(e[t],k.log,"Unknown stream type:"+e[t])}t+=5+((15&e[t+3])<<8|e[t+4])}return s}_parsePES(e){let r=0,a,t,i,s,n,o,d,l,u=e.data;if(!e||0===e.size)return null;for(;u[0].length<19&&1<u.length;){var h=new Uint8Array(u[0].length+u[1].length);h.set(u[0]),h.set(u[1],u[0].length),u[0]=h,u.splice(1,1)}if(1!==((a=u[0])[0]<<16)+(a[1]<<8)+a[2])return null;if((i=(a[4]<<8)+a[5])&&i>e.size-6)return null;if(192&(t=a[7])&&(o=536870912*(14&a[9])+4194304*(255&a[10])+16384*(254&a[11])+128*(255&a[12])+(254&a[13])/2,64&t?(d=536870912*(14&a[14])+4194304*(255&a[15])+16384*(254&a[16])+128*(255&a[17])+(254&a[18])/2,54e5<o-d&&(k.warn(Math.round((o-d)/9e4)+"s delta between PTS and DTS, align them"),o=d)):d=o),s=a[8],l=s+9,e.size<=l)return null;e.size-=l,n=new Uint8Array(e.size);for(let t=0,e=u.length;t<e;t++){let e=(a=u[t]).byteLength;if(l){if(l>e){l-=e;continue}a=a.subarray(l),e-=l,l=0}n.set(a,r),r+=e}return i&&(i-=s+3),{data:n,pts:o,dts:d,len:i}}pushAccesUnit(e,t){if(e.units.length&&e.frame){var r=t.samples,a=r.length;if(isNaN(e.pts)){if(!a)return void t.dropped++;var i=r[a-1];e.pts=i.pts,e.dts=i.dts}!this.config.forceKeyFrameOnDiscontinuity||!0===e.key||t.sps&&(a||this.contiguous)?(e.id=a,r.push(e)):t.dropped++}e.debug.length&&k.log(e.pts+"/"+e.dts+":"+e.debug)}_parseAVCPES(p,e){function m(e,t,r,a){return{key:e,pts:t,dts:r,units:[],debug:a}}let f=this._avcTrack,t=this._parseAVCNALu(p.data),g,y=this.avcSample,A,v=!1,S,b=this.pushAccesUnit.bind(this);p.data=null,y&&t.length&&!f.audFound&&(b(y,f),y=this.avcSample=m(!1,p.pts,p.dts,"")),t.forEach(e=>{switch(e.type){case 1:A=!0,(y=y||(this.avcSample=m(!0,p.pts,p.dts,""))).frame=!0;var r=e.data;v&&4<r.length&&(2!==(r=new T(r).readSliceType())&&4!==r&&7!==r&&9!==r||(y.key=!0));break;case 5:A=!0,(y=y||(this.avcSample=m(!0,p.pts,p.dts,""))).key=!0,y.frame=!0;break;case 6:A=!0,(g=new T(this.discardEPB(e.data))).readUByte();for(var t=0,a=0,i=!1,s=0;!i&&1<g.bytesAvailable;){for(t=0;t+=s=g.readUByte(),255===s;);for(a=0;a+=s=g.readUByte(),255===s;);if(4===t&&0!==g.bytesAvailable){var i=!0,n=g.readUByte();if(181===n)if(49===g.readUShort()){n=g.readUInt();if(1195456820===n)if(3===g.readUByte()){var n=g.readUByte(),o=31&n,d=[n,g.readUByte()];for(S=0;S<o;S++)d.push(g.readUByte()),d.push(g.readUByte()),d.push(g.readUByte());this._insertSampleInOrder(this._txtTrack.samples,{type:3,pts:p.pts,bytes:d})}}}else if(5===t&&0!==g.bytesAvailable){if(i=!0,16<a){var l=[];for(S=0;S<16;S++)l.push(g.readUByte().toString(16)),3!==S&&5!==S&&7!==S&&9!==S||l.push("-");var u=a-16,h=new Uint8Array(u);for(S=0;S<u;S++)h[S]=g.readUByte();this._insertSampleInOrder(this._txtTrack.samples,{pts:p.pts,payloadType:t,uuid:l.join(""),userDataBytes:h,userData:q(h.buffer)})}}else if(a<g.bytesAvailable)for(S=0;S<a;S++)g.readUByte()}break;case 7:if(A=!0,v=!0,!f.sps){var r=(g=new T(e.data)).readSPS(),c=(f.width=r.width,f.height=r.height,f.pixelRatio=r.pixelRatio,f.sps=[e.data],f.duration=this._duration,e.data.subarray(1,4));let t="avc1.";for(S=0;S<3;S++){let e=c[S].toString(16);e.length<2&&(e="0"+e),t+=e}f.codec=t}break;case 8:A=!0,f.pps||(f.pps=[e.data]);break;case 9:A=!1,f.audFound=!0,y&&b(y,f),y=this.avcSample=m(!1,p.pts,p.dts,"");break;case 12:A=!1;break;default:A=!1,y&&(y.debug+="unknown NAL "+e.type+" ")}y&&A&&y.units.push(e)}),e&&y&&(b(y,f),this.avcSample=null)}_insertSampleInOrder(t,r){var a=t.length;if(0<a){if(r.pts>=t[a-1].pts)t.push(r);else for(let e=a-1;0<=e;e--)if(r.pts<t[e].pts){t.splice(e,0,r);break}}else t.push(r)}_getLastNalUnit(){let e=this.avcSample,t;var r;return e&&0!==e.units.length||(r=this._avcTrack.samples,e=r[r.length-1]),e&&(r=e.units,t=r[r.length-1]),t}_parseAVCNALu(e){let t=0,r=e.byteLength,a,i,s=this._avcTrack,n=s.naluState||0,o=n,d=[],l,u,h=-1,c;for(-1===n&&(h=0,c=31&e[0],n=0,t=1);t<r;){var p,m;a=e[t++],n?n=1===n?a?0:2:a?1===a?(0<=h?(l={data:e.subarray(h,t-n-1),type:c},d.push(l)):(p=this._getLastNalUnit())&&(o&&t<=4-o&&p.state&&(p.data=p.data.subarray(0,p.data.byteLength-o)),0<(i=t-n-1)&&((m=new Uint8Array(p.data.byteLength+i)).set(p.data,0),m.set(e.subarray(0,i),p.data.byteLength),p.data=m)),t<r?(u=31&e[t],h=t,c=u,0):-1):0:3:n=a?0:1}var f,g;return 0<=h&&0<=n&&(l={data:e.subarray(h,r),type:c,state:n},d.push(l)),0===d.length&&(f=this._getLastNalUnit())&&((g=new Uint8Array(f.data.byteLength+e.byteLength)).set(f.data,0),g.set(e,f.data.byteLength),f.data=g),s.naluState=n,d}discardEPB(e){let t=e.byteLength,r=[],a=1,i,s;for(;a<t-2;)0===e[a]&&0===e[a+1]&&3===e[a+2]?(r.push(a+2),a+=2):a++;if(0===r.length)return e;i=t-r.length,s=new Uint8Array(i);let n=0;for(a=0;a<i;n++,a++)n===r[0]&&(n++,r.shift()),s[a]=e[n];return s}_parseAACPES(e){let t=this._audioTrack,r=e.data,a=e.pts,i=this.aacOverFlow,s=this.aacLastPTS,n,o,d,l,u;for(i&&((e=new Uint8Array(i.byteLength+r.byteLength)).set(i,0),e.set(r,i.byteLength),r=e),d=0,u=r.length;d<u-1&&!m.isHeader(r,d);d++);if(0<d&&d<u-1)d=0;else if(d){let e,t;if(t=d<u-1?(e="AAC PES did not start with ADTS header,offset:"+d,!1):(e="no ADTS header found in AAC PES",!0),k.warn("parsing error:"+e),this.observer.trigger(O.ERROR,{type:F.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,fatal:t,reason:e}),t)return}for(m.initTrackConfig(t,this.observer,r,d,this.audioCodec),o=0,n=m.getFrameDuration(t.samplerate),i&&s&&(e=s+n,1<Math.abs(e-a)&&(k.log("AAC: align PTS for overlapping frames by "+Math.round((e-a)/90)),a=e));d<u;){if(m.isHeader(r,d)){if(d+5<u){var h=m.appendFrame(t,r,d,a,o);if(h){d+=h.length,l=h.sample.pts,o++;continue}}break}d++}i=d<u?r.subarray(d,u):null,this.aacOverFlow=i,this.aacLastPTS=l}_parseMPEGPES(e){var t=e.data,r=t.length;let a=0,i=0;for(var s=e.pts;i<r;)if(f.isHeader(t,i)){var n=f.appendFrame(this._audioTrack,t,i,s,a);if(!n)break;i+=n.length,a++}else i++}_parseID3PES(e){this._id3Track.samples.push(e)}}class P{static getSilentFrame(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}const h=Math.pow(2,32)-1;class B{static init(){B.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in B.types)B.types.hasOwnProperty(e)&&(B.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),t=(B.HDLR_TYPES={video:t,audio:r},new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1])),r=new Uint8Array([0,0,0,0,0,0,0,0]),r=(B.STTS=B.STSC=B.STCO=r,B.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),B.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),B.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),B.STSD=new Uint8Array([0,0,0,0,0,0,0,1]),new Uint8Array([105,115,111,109])),a=new Uint8Array([97,118,99,49]),i=new Uint8Array([0,0,0,1]);B.FTYP=B.box(B.types.ftyp,r,i,r,a),B.DINF=B.box(B.types.dinf,B.box(B.types.dref,t))}static box(e){let t=Array.prototype.slice.call(arguments,1),r=8,a=t.length,i=a,s;for(;a--;)r+=t[a].byteLength;for((s=new Uint8Array(r))[0]=r>>24&255,s[1]=r>>16&255,s[2]=r>>8&255,s[3]=255&r,s.set(e,4),a=0,r=8;a<i;a++)s.set(t[a],r),r+=t[a].byteLength;return s}static hdlr(e){return B.box(B.types.hdlr,B.HDLR_TYPES[e])}static mdat(e){return B.box(B.types.mdat,e)}static mdhd(e,t){t*=e;var r=Math.floor(t/(1+h)),t=Math.floor(t%(1+h));return B.box(B.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,r>>24,r>>16&255,r>>8&255,255&r,t>>24,t>>16&255,t>>8&255,255&t,85,196,0,0]))}static mdia(e){return B.box(B.types.mdia,B.mdhd(e.timescale,e.duration),B.hdlr(e.type),B.minf(e))}static mfhd(e){return B.box(B.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}static minf(e){return"audio"===e.type?B.box(B.types.minf,B.box(B.types.smhd,B.SMHD),B.DINF,B.stbl(e)):B.box(B.types.minf,B.box(B.types.vmhd,B.VMHD),B.DINF,B.stbl(e))}static moof(e,t,r){return B.box(B.types.moof,B.mfhd(e),B.traf(r,t))}static moov(e){let t=e.length,r=[];for(;t--;)r[t]=B.trak(e[t]);return B.box.apply(null,[B.types.moov,B.mvhd(e[0].timescale,e[0].duration)].concat(r).concat(B.mvex(e)))}static mvex(e){let t=e.length,r=[];for(;t--;)r[t]=B.trex(e[t]);return B.box.apply(null,[B.types.mvex].concat(r))}static mvhd(e,t){t*=e;var r=Math.floor(t/(1+h)),t=Math.floor(t%(1+h)),e=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,r>>24,r>>16&255,r>>8&255,255&r,t>>24,t>>16&255,t>>8&255,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return B.box(B.types.mvhd,e)}static sdtp(e){let t=e.samples||[],r=new Uint8Array(4+t.length),a,i;for(i=0;i<t.length;i++)a=t[i].flags,r[i+4]=a.dependsOn<<4|a.isDependedOn<<2|a.hasRedundancy;return B.box(B.types.sdtp,r)}static stbl(e){return B.box(B.types.stbl,B.stsd(e),B.box(B.types.stts,B.STTS),B.box(B.types.stsc,B.STSC),B.box(B.types.stsz,B.STSZ),B.box(B.types.stco,B.STCO))}static avc1(e){let t=[],r=[],a,i,s;for(a=0;a<e.sps.length;a++)i=e.sps[a],s=i.byteLength,t.push(s>>>8&255),t.push(255&s),t=t.concat(Array.prototype.slice.call(i));for(a=0;a<e.pps.length;a++)i=e.pps[a],s=i.byteLength,r.push(s>>>8&255),r.push(255&s),r=r.concat(Array.prototype.slice.call(i));var n=B.box(B.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(r))),o=e.width,d=e.height,l=e.pixelRatio[0],u=e.pixelRatio[1];return B.box(B.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,d>>8&255,255&d,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),n,B.box(B.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),B.box(B.types.pasp,new Uint8Array([l>>24,l>>16&255,l>>8&255,255&l,u>>24,u>>16&255,u>>8&255,255&u])))}static esds(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}static mp4a(e){var t=e.samplerate;return B.box(B.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,255&t,0,0]),B.box(B.types.esds,B.esds(e)))}static mp3(e){var t=e.samplerate;return B.box(B.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,255&t,0,0]))}static stsd(e){return"audio"===e.type?e.isAAC||"mp3"!==e.codec?B.box(B.types.stsd,B.STSD,B.mp4a(e)):B.box(B.types.stsd,B.STSD,B.mp3(e)):B.box(B.types.stsd,B.STSD,B.avc1(e))}static tkhd(e){var t=e.id,r=e.duration*e.timescale,a=e.width,e=e.height,i=Math.floor(r/(1+h)),r=Math.floor(r%(1+h));return B.box(B.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,a>>8&255,255&a,0,0,e>>8&255,255&e,0,0]))}static traf(e,t){var r=B.sdtp(e),a=e.id,i=Math.floor(t/(1+h)),t=Math.floor(t%(1+h));return B.box(B.types.traf,B.box(B.types.tfhd,new Uint8Array([0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a])),B.box(B.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,t>>24,t>>16&255,t>>8&255,255&t])),B.trun(e,r.length+16+20+8+16+8+8),r)}static trak(e){return e.duration=e.duration||4294967295,B.box(B.types.trak,B.tkhd(e),B.mdia(e))}static trex(e){e=e.id;return B.box(B.types.trex,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){let r=e.samples||[],a=r.length,i=12+16*a,s=new Uint8Array(i),n,o,d,l,u,h;for(t+=8+i,s.set([0,0,15,1,a>>>24&255,a>>>16&255,a>>>8&255,255&a,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0),n=0;n<a;n++)d=(o=r[n]).duration,l=o.size,u=o.flags,h=o.cts,s.set([d>>>24&255,d>>>16&255,d>>>8&255,255&d,l>>>24&255,l>>>16&255,l>>>8&255,255&l,u.isLeading<<2|u.dependsOn,u.isDependedOn<<6|u.hasRedundancy<<4|u.paddingValue<<1|u.isNonSync,61440&u.degradPrio,15&u.degradPrio,h>>>24&255,h>>>16&255,h>>>8&255,255&h],12+16*n);return B.box(B.types.trun,s)}static initSegment(e){B.types||B.init();var e=B.moov(e),t=new Uint8Array(B.FTYP.byteLength+e.byteLength);return t.set(B.FTYP),t.set(e,B.FTYP.byteLength),t}}const $=e(10),W=e(.2);let G=null;class c{constructor(e,t,r,a){this.observer=e,this.config=t,this.typeSupported=r,this.ISGenerated=!1,null===G&&(e="Android".match(/Chrome\/(\d+)/i),G=e?parseInt(e[1]):0)}destroy(){}resetTimeStamp(e){this._initPTS=this._initDTS=e}resetInitSegment(){this.ISGenerated=!1}getVideoStartPts(e){let a=!1;e=e.reduce((e,t)=>{var r=t.pts-e;return r<-4294967296?(a=!0,e):0<r?e:t.pts},e[0].pts);return a&&k.debug("PTS rollover detected"),e}remux(r,a,e,t,i,s,n){if(this.ISGenerated||this.generateIS(r,a,i),this.ISGenerated){var o=r.samples.length,d=a.samples.length;let e=i,t=i;if(o&&d&&(l=this.getVideoStartPts(a.samples),l=(r.samples[0].pts-l)/a.inputTimeScale,e+=Math.max(0,l),t+=Math.max(0,-l)),o){r.timescale||(k.warn("regenerate InitSegment as audio detected"),this.generateIS(r,a,i));var l=this.remuxAudio(r,e,s,n,t);if(d){let e;l&&(e=l.endPTS-l.startPTS),a.timescale||(k.warn("regenerate InitSegment as video detected"),this.generateIS(r,a,i)),this.remuxVideo(a,t,s,e)}}else!d||(o=this.remuxVideo(a,t,s,0))&&r.codec&&this.remuxEmptyAudio(r,e,s,o)}e.samples.length&&this.remuxID3(e,i),t.samples.length&&this.remuxText(t,i),this.observer.trigger(O.FRAG_PARSED)}generateIS(e,t,r){let a=this.observer,i=e.samples,s=t.samples,n=this.typeSupported,o="audio/mp4",d={},l={tracks:d},u=void 0===this._initPTS,h,c;u&&(h=c=1/0),e.config&&i.length&&(e.timescale=e.samplerate,k.log("audio sampling rate : "+e.samplerate),e.isAAC||(n.mpeg?(o="audio/mpeg",e.codec=""):n.mp3&&(e.codec="mp3")),d.audio={container:o,codec:e.codec,initSegment:!e.isAAC&&n.mpeg?new Uint8Array:B.initSegment([e]),metadata:{channelCount:e.channelCount}},u&&(h=c=i[0].pts-Math.round(e.inputTimeScale*r))),t.sps&&t.pps&&s.length?(e=t.inputTimeScale,t.timescale=e,d.video={container:"video/mp4",codec:t.codec,initSegment:B.initSegment([t]),metadata:{width:t.width,height:t.height}},u&&(t=this.getVideoStartPts(s),e=Math.round(e*r),c=Math.min(c,s[0].dts-e),h=Math.min(h,t-e),this.observer.trigger(O.INIT_PTS_FOUND,{initPTS:h}))):u&&d.audio&&this.observer.trigger(O.INIT_PTS_FOUND,{initPTS:h}),Object.keys(d).length?(a.trigger(O.FRAG_PARSING_INIT_SEGMENT,l),this.ISGenerated=!0,u&&(this._initPTS=h,this._initDTS=c)):a.trigger(O.ERROR,{type:F.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})}remuxVideo(e,t,i,s){var n=e.timescale,o=e.samples,d=[],l=o.length,u=this._initPTS;let h=8,c,p,m,f,g=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY,A=0,v=!1,S=this.nextAvcDts;if(0!==l){i||(t=t*n,D=o[0].pts-V(o[0].dts,o[0].pts),S=t-D);for(let e=0;e<l;e++){var b=o[e];b.pts=V(b.pts-u,S),b.dts=V(b.dts-u,S),b.dts>b.pts&&(A=Math.max(Math.min(A,b.pts-b.dts),-1*W)),b.dts<o[0<e?e-1:e].dts&&(v=!0)}v&&o.sort(function(e,t){var r=e.dts-t.dts,a=e.pts-t.pts;return r||a||e.id-t.id}),m=o[0].dts,f=o[l-1].dts;var T=Math.round((f-m)/(l-1));if(A<0){if(A<-2*T){k.warn(`PTS < DTS detected in video samples, offsetting DTS to PTS ${M(-T,!0)} ms`);for(let e=0;e<l;e++)o[e].dts=o[e].pts-T}else{k.warn(`PTS < DTS detected in video samples, shifting DTS by ${M(A,!0)} ms to overcome this issue`);for(let e=0;e<l;e++)o[e].dts=o[e].dts+A}m=o[0].dts,f=o[l-1].dts}!i||((D=T<(t=m-S))||t<-1)&&(D?k.warn(`AVC: ${M(t,!0)} ms (${t}dts) hole between fragments detected, filling it`):k.warn(`AVC: ${M(-t,!0)} ms (${t}dts) overlapping between fragments detected`),m=S,i=o[0].pts-t,o[0].dts=m,o[0].pts=i,k.log(`Video: First PTS/DTS adjusted: ${M(i,!0)}/${M(m,!0)}, delta: ${M(t,!0)} ms`)),G&&G<75&&(m=Math.max(0,m));let r=0,a=0;for(let e=0;e<l;e++){var E=o[e],R=E.units,_=R.length;let t=0;for(let e=0;e<_;e++)t+=R[e].data.length;a+=t,r+=_,E.length=t,E.dts=Math.max(E.dts,m),E.pts=Math.max(E.pts,E.dts,0),g=Math.min(E.pts,g),y=Math.max(E.pts,y)}f=o[l-1].dts;var D=a+4*r+8;try{p=new Uint8Array(D)}catch(e){return void this.observer.trigger(O.ERROR,{type:F.MUX_ERROR,details:N.REMUX_ALLOC_ERROR,fatal:!1,bytes:D,reason:"fail allocating video mdat "+D})}var I=new DataView(p.buffer);I.setUint32(0,D),p.set(B.types.mdat,4);for(let e=0;e<l;e++){var U,w,C=o[e],x=C.units;let r=0;for(let e=0,t=x.length;e<t;e++){var P=x[e],L=P.data,P=P.data.byteLength;I.setUint32(h,P),h+=4,p.set(L,h),h+=P,r+=4+P}e<l-1?c=o[e+1].dts-C.dts:(w=this.config,U=C.dts-o[0<e?e-1:e].dts,w.stretchShortVideoTrack&&(w=w.maxBufferHole,Math.floor(w*n)<(w=(s?g+s*n:this.nextAudioPts)-C.pts))?((c=w-U)<0&&(c=U),k.log(`It is approximately ${M(w,!1)} ms to the next segment; using duration ${M(c,!1)} ms for the last video frame.`)):c=U),w=Math.round(C.pts-C.dts),d.push({size:r,duration:c,cts:w,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:C.key?2:1,isNonSync:C.key?0:1}})}this.nextAvcDts=f+c;i=e.dropped,t=(e.nbNalu=0,e.dropped=0,d.length&&-1<"Android".toLowerCase().indexOf("chrome")&&((t=d[0].flags).dependsOn=2,t.isNonSync=0),e.samples=d,D=B.moof(e.sequenceNumber++,m,e),e.samples=[],{data1:D,data2:p,startPTS:g/n,endPTS:(y+c)/n,startDTS:m/n,endDTS:this.nextAvcDts/n,type:"video",hasAudio:!1,hasVideo:!0,nb:d.length,dropped:i});return this.observer.trigger(O.FRAG_PARSING_DATA,t),t}}remuxAudio(a,i,s,n,o){const d=a.inputTimeScale;var l=a.timescale,u=d/l,h=(a.isAAC?1024:1152)*u;const t=this._initPTS;var c=!a.isAAC&&this.typeSupported.mpeg;let p,m,f,g,y,A,v=c?0:8,S=a.samples;var b=[];let T=this.nextAudioPts;if(s|=S.length&&T&&(n&&Math.abs(i-T/d)<.1||Math.abs(S[0].pts-T-t)<20*h),S.forEach(function(e){e.pts=e.dts=V(e.pts-t,i*d)}),0!==(S=S.filter(e=>0<=e.pts)).length){if(s||(T=0===o?0:n?Math.max(0,i*d):S[0].pts),a.isAAC){var E=this.config.maxAudioFramesDrift;for(let t=0,r=T;t<S.length;){var R=S[t],_=R.pts,D=_-r;if(D<=-E*h)s||0<t?(k.warn(`Dropping 1 audio frame @ ${M(r,!0)/1e3}s due to ${M(D,!0)} ms overlap.`),S.splice(t,1)):(k.warn(`Audio frame @ ${M(_,!0)/1e3}s overlaps nextAudioPts by ${M(D,!0)} ms.`),r=_+h,t++);else{if(E*h<=D&&D<$){var I=Math.floor(D/h);r=_-I*h,k.warn(`Injecting ${I} audio frames @ ${M(r,!0)/1e3}s due to ${M(D,!0)} ms gap.`);for(let e=0;e<I;e++){var U=Math.max(r,0);(m=P.getSilentFrame(a.manifestCodec||a.codec,a.channelCount))||(k.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),m=R.unit.subarray()),S.splice(t,0,{unit:m,pts:U,dts:U}),r+=h,t++}}else Math.abs(D);R.pts=R.dts=r,r+=h,t++}}}let e=S.length,r=0;for(;e--;)r+=S[e].unit.byteLength;for(let t=0,e=S.length;t<e;t++){var w=S[t],C=w.unit;let e=w.pts;if(void 0!==A&&p)p.duration=Math.round((e-A)/u);else{w=e-T;let t=0;if(s&&a.isAAC&&w){if(0<w&&w<$)t=Math.round((e-T)/h),k.log(M(w,!0)+" ms hole between AAC samples detected,filling it"),0<t&&(m=(m=P.getSilentFrame(a.manifestCodec||a.codec,a.channelCount))||C.subarray(),r+=t*m.length);else if(w<-12){k.log(`drop overlapping AAC sample, expected/parsed/delta: ${M(T,!0)} ms / ${M(e,!0)} ms / ${M(-w,!0)} ms`),r-=C.byteLength;continue}e=T}if(y=e,!(0<r))return;r+=v;try{f=new Uint8Array(r)}catch(e){return void this.observer.trigger(O.ERROR,{type:F.MUX_ERROR,details:N.REMUX_ALLOC_ERROR,fatal:!1,bytes:r,reason:"fail allocating audio mdat "+r})}c||(new DataView(f.buffer).setUint32(0,r),f.set(B.types.mdat,4));for(let e=0;e<t;e++)(m=P.getSilentFrame(a.manifestCodec||a.codec,a.channelCount))||(k.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),m=C.subarray()),f.set(m,v),v+=m.byteLength,p={size:m.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},b.push(p)}f.set(C,v);w=C.byteLength;v+=w,p={size:w,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},b.push(p),A=e}let t=0;return 2<=(e=b.length)&&(t=b[e-2].duration,p.duration=t),e?(this.nextAudioPts=T=A+u*t,a.samples=b,g=c?new Uint8Array:B.moof(a.sequenceNumber++,y/u,a),a.samples=[],l=y/d,o=T/d,n={data1:g,data2:f,startPTS:l,endPTS:o,startDTS:l,endDTS:o,type:"audio",hasAudio:!0,hasVideo:!1,nb:e},this.observer.trigger(O.FRAG_PARSING_DATA,n),n):null}}remuxEmptyAudio(e,t,r,a){var i=e.inputTimeScale,s=e.samplerate||i,n=this.nextAudioPts,o=(void 0!==n?n:a.startDTS*i)+this._initDTS,n=a.endDTS*i+this._initDTS,d=1024*(i/s),l=Math.ceil((n-o)/d),u=P.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(k.warn("remux empty Audio"),u){var h=[];for(let e=0;e<l;e++){var c=o+e*d;h.push({unit:u,pts:c,dts:c})}e.samples=h,this.remuxAudio(e,t,r)}else k.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")}remuxID3(t,r){var a=t.samples.length;if(a){var i=t.inputTimeScale,s=this._initPTS,n=this._initDTS;for(let e=0;e<a;e++){var o=t.samples[e];o.pts=V(o.pts-s,r*i)/i,o.dts=V(o.dts-n,r*i)/i}this.observer.trigger(O.FRAG_PARSING_METADATA,{samples:t.samples}),t.samples=[]}}remuxText(t,r){var a=t.samples.length,i=t.inputTimeScale,s=this._initPTS;if(a){for(let e=0;e<a;e++){var n=t.samples[e];n.pts=V(n.pts-s,r*i)/i}t.samples.sort(function(e,t){return e.pts-t.pts}),this.observer.trigger(O.FRAG_PARSING_USERDATA,{samples:t.samples})}t.samples=[]}}function V(e,t){let r;if(void 0!==t)for(r=t<e?-8589934592:8589934592;4294967296<Math.abs(e-t);)e+=r;return e}class p{constructor(e,t){this.observer=e,this.remuxer=t}resetTimeStamp(e){this.initPTS=e}resetInitSegment(e,t,r,a){var i,s;e&&e.byteLength?(null==t&&(t="mp4a.40.5"),null==r&&(r="avc1.42e01e"),s={},(i=this.initData=p.parseInitSegment(e)).audio&&i.video?s.audiovideo={container:"video/mp4",codec:t+","+r,initSegment:a?e:null}:(i.audio&&(s.audio={container:"audio/mp4",codec:t,initSegment:a?e:null}),i.video&&(s.video={container:"video/mp4",codec:r,initSegment:a?e:null})),this.observer.trigger(O.FRAG_PARSING_INIT_SEGMENT,{tracks:s})):(t&&(this.audioCodec=t),r&&(this.videoCodec=r))}static probe(e){return 0<p.findBox({data:e,start:0,end:Math.min(e.length,16384)},["moof"]).length}static bin2str(e){return String.fromCharCode.apply(null,e)}static readUint16(e,t){e.data&&(t+=e.start,e=e.data);e=e[t]<<8|e[t+1];return e<0?65536+e:e}static readUint32(e,t){e.data&&(t+=e.start,e=e.data);e=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3];return e<0?4294967296+e:e}static writeUint32(e,t,r){e.data&&(t+=e.start,e=e.data),e[t]=r>>24,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=255&r}static findBox(e,t){let r=[],a,i,s,n,o,d,l;if(e.data?(d=e.start,n=e.end,e=e.data):(d=0,n=e.byteLength),!t.length)return null;for(a=d;a<n;)i=p.readUint32(e,a),s=p.bin2str(e.subarray(a+4,a+8)),l=1<i?a+i:n,s===t[0]&&(1===t.length?r.push({data:e,start:a+8,end:l}):(o=p.findBox({data:e,start:a+8,end:l},t.slice(1))).length&&(r=r.concat(o))),a=l;return r}static parseSegmentIndex(e){var t=p.findBox(e,["moov"])[0],t=t?t.end:null;let r=0;var a=p.findBox(e,["sidx"]);if(!a||!a[0])return null;var i=[],e=(a=a[0]).data[0],s=(r=0===e?8:16,p.readUint32(a,r));r=(r+=4)+(0===e?8:16)+2;let n=a.end+0;var o=p.readUint16(a,r);r+=2;for(let e=0;e<o;e++){var d=r,l=p.readUint32(a,d),u=(d+=4,2147483647&l);if(1==(2147483648&l)>>>31)return void console.warn("SIDX has hierarchical references (not supported)");l=p.readUint32(a,d);d+=4,i.push({referenceSize:u,subsegmentDuration:l,info:{duration:l/s,start:n,end:n+u-1}}),n+=u,d+=4,r=d}return{earliestPresentationTime:0,timescale:s,version:e,referencesCount:o,references:i,moovEndOffset:t}}static parseInitSegment(e){let i=[];return p.findBox(e,["moov","trak"]).forEach(e=>{var t,r,a=p.findBox(e,["tkhd"])[0];a&&(r=0===a.data[a.start]?12:20,a=p.readUint32(a,r),(t=p.findBox(e,["mdia","mdhd"])[0])&&(r=0===t.data[t.start]?12:20,t=p.readUint32(t,r),(r=p.findBox(e,["mdia","hdlr"])[0])&&(r={soun:"audio",vide:"video"}[p.bin2str(r.data.subarray(r.start+8,r.start+12))])&&((e=p.findBox(e,["mdia","minf","stbl","stsd"])).length&&(e=e[0],e=p.bin2str(e.data.subarray(e.start+12,e.start+16)),k.log(`MP4Demuxer:${r}:${e} found`)),i[a]={timescale:t,type:r},i[r]={timescale:t,id:a})))}),i}static getStartDTS(r,e){e=p.findBox(e,["moof","traf"]),e=[].concat.apply([],e.map(function(t){return p.findBox(t,["tfhd"]).map(function(e){e=p.readUint32(e,4),e=r[e].timescale||9e4;return p.findBox(t,["tfdt"]).map(function(e){let t,r;return t=e.data[e.start],r=p.readUint32(e,4),r=1===t?(r*=Math.pow(2,32))+p.readUint32(e,8):r})[0]/e})})),e=Math.min.apply(null,e);return isFinite(e)?e:0}static offsetStartDTS(r,e,i){p.findBox(e,["moof","traf"]).map(function(t){return p.findBox(t,["tfhd"]).map(function(e){e=p.readUint32(e,4);let a=r[e].timescale||9e4;p.findBox(t,["tfdt"]).map(function(e){var t=e.data[e.start],r=p.readUint32(e,4);0===t?p.writeUint32(e,4,r-i*a):(r=(r=(r*=Math.pow(2,32))+p.readUint32(e,8))-i*a,r=Math.max(r,0),t=Math.floor(r/(1+h)),r=Math.floor(r%(1+h)),p.writeUint32(e,4,t),p.writeUint32(e,8,r))})})})}append(e,t,r,a){let i=this.initData;i||(this.resetInitSegment(e,this.audioCodec,this.videoCodec,!1),i=this.initData);let s,n=this.initPTS;var o;void 0===n&&(o=p.getStartDTS(i,e),this.initPTS=n=o-t,this.observer.trigger(O.INIT_PTS_FOUND,{initPTS:n})),p.offsetStartDTS(i,e,n),s=p.getStartDTS(i,e),this.remuxer.remux(i.audio,i.video,null,null,s,r,a,e)}destroy(){}}class g{static isHeader(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128}static isFooter(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128}static getID3Data(e,t){var r=t;let a=0;for(;g.isHeader(e,t);){a+=10;var i=g._readSize(e,t+6);a+=i,g.isFooter(e,t+10)&&(a+=10),t+=a}if(0<a)return e.subarray(r,r+a)}static _readSize(e,t){var r=(127&e[t])<<21;return(r|=(127&e[t+1])<<14)|(127&e[t+2])<<7|127&e[t+3]}static getTimeStamp(e){var t=g.getID3Frames(e);for(let e=0;e<t.length;e++){var r=t[e];if(g.isTimeStampFrame(r))return g._readTimeStamp(r)}}static isTimeStampFrame(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info}static _getFrameData(e){var t=String.fromCharCode(e[0],e[1],e[2],e[3]),r=g._readSize(e,4);return{type:t,size:r,data:e.subarray(10,10+r)}}static getID3Frames(e){let t=0;for(var r=[];g.isHeader(e,t);){for(var a=g._readSize(e,t+6),i=(t+=10)+a;t+8<i;){var s=g._getFrameData(e.subarray(t)),n=g._decodeFrame(s);n&&r.push(n),t+=s.size+10}g.isFooter(e,t)&&(t+=10)}return r}static _decodeFrame(e){return"PRIV"===e.type?g._decodePrivFrame(e):"T"===e.type[0]?g._decodeTextFrame(e):"W"===e.type[0]?g._decodeURLFrame(e):void 0}static _readTimeStamp(t){if(8===t.data.byteLength){var t=new Uint8Array(t.data),r=1&t[3];let e=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return e/=45,r&&(e+=47721858.84),Math.round(e)}}static _decodePrivFrame(e){var t,r;if(!(e.size<2))return t=g._utf8ArrayToStr(e.data,!0),r=new Uint8Array(e.data.subarray(t.length+1)),{key:e.type,info:t,data:r.buffer}}static _decodeTextFrame(e){var t,r;if(!(e.size<2))return"TXXX"===e.type?(t=1,t+=(r=g._utf8ArrayToStr(e.data.subarray(1),!0)).length+1,t=g._utf8ArrayToStr(e.data.subarray(t)),{key:e.type,info:r,data:t}):(r=g._utf8ArrayToStr(e.data.subarray(1)),{key:e.type,data:r})}static _decodeURLFrame(e){var t,r;return"WXXX"!==e.type?(r=g._utf8ArrayToStr(e.data),{key:e.type,data:r}):e.size<2?void 0:(r=1,r+=(t=g._utf8ArrayToStr(e.data.subarray(1),!0)).length+1,r=g._utf8ArrayToStr(e.data.subarray(r)),{key:e.type,info:t,data:r})}static _utf8ArrayToStr(e,t=!1){var r,a=j();if(a)return a=a.decode(e),t?-1!==(r=a.indexOf("\0"))?a.substring(0,r):a:a.replace(/\0/g,"");var i,s,n=e.length;let o,d="",l=0;for(;l<n;){if(0===(i=e[l++])&&t)return d;if(0!==i&&3!==i)switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:d+=String.fromCharCode(i);break;case 12:case 13:o=e[l++],d+=String.fromCharCode((31&i)<<6|63&o);break;case 14:o=e[l++],s=e[l++],d+=String.fromCharCode((15&i)<<12|(63&o)<<6|(63&s)<<0)}}return d}}let y;function j(){var e=t();return y=y||void 0===e.TextDecoder?y:new e.TextDecoder("utf-8")}const q=g._utf8ArrayToStr;class Z{constructor(e){this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=e,this.version=null}get hasProgramDateTime(){return!(!this.fragments[0]||!Number.isFinite(this.fragments[0].programDateTime))}}Object.defineProperty(Q.prototype,"uri",{get:function(){return!this._uri&&this.reluri&&(this._uri=URLToolkit.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri},enumerable:!1,configurable:!0});var A,C=Q;function Q(e,t){this._uri=null,this.method=null,this.key=null,this.iv=null,this.baseuri=e,this.reluri=t}(S=A=A||{}).AUDIO="audio",S.VIDEO="video";v.prototype.setByteRange=function(e,t){var e=e.split("@",2),r=[];1===e.length?r[0]=t?t.byteRangeEndOffset:0:r[0]=parseInt(e[1]),r[1]=parseInt(e[0])+r[0],this._byteRange=r},Object.defineProperty(v.prototype,"url",{get:function(){return!this._url&&this.relurl&&(this._url=URLToolkit.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(e){this._url=e},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"byteRange",{get:function(){return this._byteRange||[]},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"byteRangeStartOffset",{get:function(){return this.byteRange[0]},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"byteRangeEndOffset",{get:function(){return this.byteRange[1]},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"decryptdata",{get:function(){var e;return this.levelkey||this._decryptdata?(!this._decryptdata&&this.levelkey&&("number"!=typeof(e=this.sn)&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&k.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),e=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,e)),this._decryptdata):null},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"endProgramDateTime",{get:function(){var e;return null!==this.programDateTime&&Number.isFinite(this.programDateTime)?(e=Number.isFinite(this.duration)?this.duration:0,this.programDateTime+1e3*e):null},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"encrypted",{get:function(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)},enumerable:!1,configurable:!0}),v.prototype.addElementaryStream=function(e){this._elementaryStreams[e]=!0},v.prototype.hasElementaryStream=function(e){return!0===this._elementaryStreams[e]},v.prototype.createInitializationVector=function(e){for(var t=new Uint8Array(16),r=12;r<16;r++)t[r]=e>>8*(15-r)&255;return t},v.prototype.setDecryptDataFromLevelKey=function(e,t){var r=e;return null!=e&&e.method&&e.uri&&!e.iv&&((r=new C(e.baseuri,e.reluri)).method=e.method,r.iv=this.createInitializationVector(t)),r};var L=v;function v(){var e;this._url=null,this._byteRange=null,this._decryptdata=null,this._elementaryStreams=((e={})[A.AUDIO]=!1,e[A.VIDEO]=!1,e),this.deltaPTS=0,this.rawProgramDateTime=null,this.programDateTime=null,this.title=null,this.tagList=[],this.sn=0,this.urlId=0,this.level=0}var J=/(?:#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)|#EXT-X-SESSION-DATA:([^\n\r]*)[\r\n]+)/g,ee=/#EXT-X-MEDIA:(.*)/g,te=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),re=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,ae=/\.(mp4|m4s|m4v|m4a)$/i,S=(b.findGroup=function(e,t){for(var r=0;r<e.length;r++){var a=e[r];if(a.id===t)return a}},b.convertAVC1ToAVCOTI=function(e){var t=e.split("."),r=2<t.length?(r=t.shift()+".",(r+=parseInt(t.shift()).toString(16))+("000"+parseInt(t.shift()).toString(16)).substr(-4)):e;return r},b.resolve=function(e,t){return URLToolkit.buildAbsoluteURL(t,e,{alwaysNormalize:!0})},b.parseMasterPlaylist=function(e,t){var r,a,i,s,n=[],o={},d=!1;function l(a,i){["video","audio"].forEach(function(r){var e,t=a.filter(function(e){return e=e,!!(t=_[t=r])&&!0===t[e.slice(0,4)];var t});t.length&&(e=t.filter(function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)}),i[r+"Codec"]=(0<e.length?e:t)[0],a=a.filter(function(e){return-1===t.indexOf(e)}))}),i.unknownCodecs=a}for(J.lastIndex=0;null!=(r=J.exec(e));)r[1]?(i=(a={}).attrs=new w(r[1]),a.url=b.resolve(r[2],t),(s=i.decimalResolution("RESOLUTION"))&&(a.width=s.width,a.height=s.height),a.bitrate=i.decimalInteger("AVERAGE-BANDWIDTH")||i.decimalInteger("BANDWIDTH"),a.name=i.NAME,l([].concat((i.CODECS||"").split(/[ ,]+/)),a),a.videoCodec&&-1!==a.videoCodec.indexOf("avc1")&&(a.videoCodec=b.convertAVC1ToAVCOTI(a.videoCodec)),n.push(a)):r[3]&&(s=new w(r[3]))["DATA-ID"]&&(d=!0,o[s["DATA-ID"]]=s);return{levels:n,sessionData:d?o:null}},b.parseMasterPlaylistMedia=function(e,t,r,a){void 0===a&&(a=[]);var i=[],s=0;for(ee.lastIndex=0;null!==(o=ee.exec(e));){var n,o=new w(o[1]);o.TYPE===r&&(n={attrs:o,id:s++,groupId:o["GROUP-ID"],instreamId:o["INSTREAM-ID"],name:o.NAME||o.LANGUAGE,type:r,default:"YES"===o.DEFAULT,autoselect:"YES"===o.AUTOSELECT,forced:"YES"===o.FORCED,lang:o.LANGUAGE},o.URI&&(n.url=b.resolve(o.URI,t)),a.length&&(o=b.findGroup(a,n.groupId),n.audioCodec=(o||a[0]).codec),i.push(n))}return i},b.parseLevelPlaylist=function(e,t,r,a,i){var s,n,o,d=0,l=0,u=new Z(t),h=0,c=null,p=new L,m=null;for(te.lastIndex=0;null!==(s=te.exec(e));){var f=s[1];if(f){p.duration=parseFloat(f);var g=(" "+s[2]).slice(1);p.title=g||null,p.tagList.push(g?["INF",f,g]:["INF",f])}else if(s[3])Number.isFinite(p.duration)&&(g=d++,p.type=a,p.start=l,o&&(p.levelkey=o),p.sn=g,p.level=r,p.cc=h,p.urlId=i,p.baseurl=t,p.relurl=(" "+s[3]).slice(1),y=f=void 0,y=c,(f=p).rawProgramDateTime?f.programDateTime=Date.parse(f.rawProgramDateTime):null!=y&&y.programDateTime&&(f.programDateTime=y.endProgramDateTime),Number.isFinite(f.programDateTime)||(f.programDateTime=null,f.rawProgramDateTime=null),u.fragments.push(p),l+=(c=p).duration,p=new L);else if(s[4]){var y=(" "+s[4]).slice(1);c?p.setByteRange(y,c):p.setByteRange(y)}else if(s[5])p.rawProgramDateTime=(" "+s[5]).slice(1),p.tagList.push(["PROGRAM-DATE-TIME",p.rawProgramDateTime]),null===m&&(m=u.fragments.length);else if(s=s[0].match(re)){for(n=1;n<s.length&&void 0===s[n];n++);var A=(" "+s[n+1]).slice(1),v=(" "+s[n+2]).slice(1);switch(s[n]){case"#":p.tagList.push(v?[A,v]:[A]);break;case"PLAYLIST-TYPE":u.type=A.toUpperCase();break;case"MEDIA-SEQUENCE":d=u.startSN=parseInt(A);break;case"TARGETDURATION":u.targetduration=parseFloat(A);break;case"VERSION":u.version=parseInt(A);break;case"EXTM3U":break;case"ENDLIST":u.live=!1;break;case"DIS":h++,p.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":h=parseInt(A);break;case"KEY":var S=A,S=new w(S),b=S.enumeratedString("METHOD"),T=S.URI,E=S.hexadecimalInteger("IV");"com.apple.streamingkeydelivery"===(S.KEYFORMAT||"identity")?k.warn("Keyformat com.apple.streamingkeydelivery is not supported"):b&&(o=new C(t,T),T&&0<=["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(b)&&(o.method=b,o.key=null,o.iv=E));break;case"START":S=new w(A).decimalFloatingPoint("TIME-OFFSET");Number.isFinite(S)&&(u.startTimeOffset=S);break;case"MAP":T=new w(A);p.relurl=T.URI,T.BYTERANGE&&p.setByteRange(T.BYTERANGE),p.baseurl=t,p.level=r,p.type=a,p.sn="initSegment",u.initSegment=p,(p=new L).rawProgramDateTime=u.initSegment.rawProgramDateTime;break;default:k.warn("line parsed but not handled: "+s)}}else k.warn("No matches on slow regex match for level playlist!")}if((p=c)&&!p.relurl&&(u.fragments.pop(),l-=p.duration),u.totalduration=l,u.averagetargetduration=l/u.fragments.length,u.endSN=d-1,u.startCC=u.fragments[0]?u.fragments[0].cc:0,u.endCC=h,!u.initSegment&&u.fragments.length&&u.fragments.every(function(e){return ae.test(e.relurl)})&&(k.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(p=new L).relurl=u.fragments[0].relurl,p.baseurl=t,p.level=r,p.type=a,p.sn="initSegment",u.initSegment=p,u.needSidxRanges=!0),m)for(var R=u.fragments,_=m,D=R[_],I=_-1;0<=I;I--){var U=R[I];U.programDateTime=D.programDateTime-1e3*U.duration,D=U}return u},b);function b(){}var ie=[{demux:x,remux:c},{demux:p,remux:class{constructor(e){this.observer=e}destroy(){}resetTimeStamp(){}resetInitSegment(){}remux(e,t,r,a,i,s,n,o){var d=this.observer;let l="";e&&(l+="audio"),t&&(l+="video"),d.trigger(O.FRAG_PARSING_DATA,{data1:o,startPTS:i,startDTS:i,type:l,hasAudio:!!e,hasVideo:!!t,nb:1,dropped:0}),d.trigger(O.FRAG_PARSED)}}},{demux:class{constructor(e,t,r){this.observer=e,this.config=r,this.remuxer=t}resetInitSegment(e,t,r,a){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:t,duration:a,inputTimeScale:9e4}}resetTimeStamp(){}static probe(t){if(t){let e=(g.getID3Data(t,0)||[]).length;for(var r=t.length;e<r;e++)if(m.probe(t,e))return k.log("ADTS sync word found !"),!0}return!1}append(e,t,r,a){var i=this._audioTrack,s=g.getID3Data(e,0)||[],n=g.getTimeStamp(s),o=Number.isFinite(n)?90*n:9e4*t;let d=0,l=o;var u=e.length;let h=s.length;for(var c=[{pts:l,dts:l,data:s}];h<u-1;)if(m.isHeader(e,h)&&h+5<u){m.initTrackConfig(i,this.observer,e,h,i.manifestCodec);var p=m.appendFrame(i,e,h,o,d);if(!p){k.log("Unable to parse AAC frame");break}h+=p.length,l=p.sample.pts,d++}else g.isHeader(e,h)?(s=g.getID3Data(e,h),c.push({pts:l,dts:l,data:s}),h+=s.length):h++;this.remuxer.remux(i,{samples:[]},{samples:c,inputTimeScale:9e4},{samples:[]},t,r,a)}destroy(){}},remux:c},{demux:class{constructor(e,t,r){this.observer=e,this.config=r,this.remuxer=t}resetInitSegment(e,t,r,a){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:t,duration:a,inputTimeScale:9e4}}resetTimeStamp(){}static probe(e){let t,r;var a=g.getID3Data(e,0)||[];if(a&&(g.getTimeStamp(a),1))for(t=a.length,r=Math.min(e.length-1,t+100);t<r;t++)if(f.probe(e,t))return k.log("MPEG Audio sync word found !"),!0;return!1}append(e,t,r,a){var i=g.getID3Data(e,0)||[],s=g.getTimeStamp(i)||0,n=90*s;let o=i.length;var d=e.length;let l=0,u=0;for(var h=this._audioTrack,c=[{pts:n,dts:n,data:i}];o<d;)if(f.isHeader(e,o)){var p=f.appendFrame(h,e,o,n,l);if(!p)break;o+=p.length,u=p.sample.pts,l++}else g.isHeader(e,o)?(i=g.getID3Data(e,o),c.push({pts:u,dts:u,data:i}),o+=i.length):o++;this.remuxer.remux(h,{samples:[]},{samples:c,inputTimeScale:9e4},{samples:[]},t,r,a)}destroy(){}},remux:c}];Object.assign(E,{HlsEvents:O,Fragment:L,LevelKey:C,isCodecSupportedInMp4:function(e,t){return MediaSource.isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"')},MpegAudio:f,M3U8Parser:S,AESDecryptor:U,HlsMux:ie,boxSetUp:{iods:{},stsd:{},stdp:{},mdat:{},stsh:{},vmhd:{},trun:{struct:[["version","int",1],["flags","int",3],["sampleCount","int",4],["dataOffset","int",4,"if",1],["firstSampleFlags","int",4,"if",4],["samples",[["duration","int",4,"if",256],["size","int",4,"if",512],["flags","int",4,"if",1024],["compositionTimeOffset","int",4,"if",2048]],"sampleCount"]]},tfhd:{minLength:8,struct:[["version","int",1],["flags","int",3],["trackID","int",4],["baseDataOffset","int",8,"if",1],["sampleDescriptionIndex","int",4,"if",2],["defaultSampleDuration","int",4,"if",8],["defaultSampleSize","int",4,"if",16],["defaultSampleFlags","int",4,"if",32],["emptyDuration","int",4],["iframeSwitching","int",1]]},smhd:{struct:[["version","int",1],["flags","int",3],["balance","int",2],["reserved","int",2]]},sdtp:{struct:[["version","int",1],["flags","int",3],["sampleDependencies",["int",4],"end"]]},stco:{struct:[["version","int",1],["flags","int",3],["entryCount","int",4],["chunkOffsets",["int",4],"entryCount"]]},hdlr:{struct:[["version","int",1],["flags","int",3],["preDefined","int",4],["handlerType","text",4],["reserved","skip",12],["name","text",0]]},elst:{struct:[["version","int",1],["flags","int",3],["entryCount","int",4],["entries",[["segmentDuration","int",4,"or",8],["mediaTime","int",4,"or",8],["mediaRateInteger","int",2],["mediaRateFraction","int",2]],"entryCount"]]},tkhd:{struct:[["version","int",1],["flags","int",3],["creationTime","int",4,"or",8],["modificationTime","int",4,"or",8],["trackID","int",4],["reserved1","int",4],["duration","int",4,"or",8],["reserved2","skip",8],["layer","int",2],["alternateGroup","int",2],["volume","int",2],["reserved3","int",2],["matrix",["int",4],9],["width","int",4],["height","int",4]]},mvhd:{struct:[["version","int",1],["flags","int",3],["creationTime","int",4,"or",8],["modificationTime","int",4,"or",8],["timeScale","int",4],["duration","int",4,"or",8],["rate","int",4],["volume","int",2],["reserved","skip",10],["matrix",["int",4],9],["preDefined","skip",24],["nextTrackID","int",4]]},ftyp:{struct:[["majorBrand","text",4],["minorVersion","int",4],["compatibleBrands",["text",4],"end"]]},mehd:{struct:[["version","int",1],["flags","int",3],["fragmentDuration","int",4,"or",8]]},trex:{struct:[["version","int",1],["flags","int",3],["trackID","int",4],["sampleDescriptionIndex","int",4],["sampleDuration","int",4],["sampleSize","int",4],["sampleFlags","int",4]]},trep:{struct:[["version","int",1],["flags","int",3],["trackID","int",4]]},mdhd:{struct:[["version","int",1],["flags","int",3],["creationTime","int",4,"or",8],["modificationTime","int",4,"or",8],["timeScale","int",4],["duration","int",4,"or",8],["languageValues","int",2],["QTQuality","int",2]]},dref:{struct:[["version","int",1],["flags","int",3],["entryCount","int",4],["entrySize","int",4],["typeText","text",4],["entryVersion","int",1],["entryFlags","int",3]]},stts:{struct:[["version","int",1],["flags","int",3],["entryCount","int",4],["entries",[["sampleCount","int",4],["sampleDuration","int",4]],"entryCount"]]},stss:{struct:[["version","int",1],["flags","int",3],["entryCount","int",4],["syncSamples",["int",4],"entryCount"]]},stsz:{struct:[["version","int",1],["flags","int",3],["sampleSize","int",4],["sampleCount","int",4],["sampleSizes",["int",4],"sampleCount"]]},stsc:{struct:[["version","int",1],["flags","int",3],["entryCount","int",4],["entries",[["firstChunk","int",4],["samplesPerChunk","int",4],["sampleDescriptionIndex","int",4]],"entryCount"]]},co64:{struct:[["version","int",1],["flags","int",3],["entryCount","int",4],["chunkOffsets",["int",8],"entryCount"]]},ctts:{struct:[["version","int",1],["flags","int",3],["entryCount","int",4],["entries",[["sampleCount","int",4],["sampleOffset","int",4]],"entryCount"]]},sidx:{struct:[["version","int",1],["flags","int",3],["referenceID","int",4],["timeScale","int",4],["earliestPresentationTime","int",4,"or",8],["firstOffset","int",4,"or",8],["reserved","int",2],["referenceCount","int",2],["references",[["subsegmentSize","int",4],["subsegmentDuration","int",4],["RAPDeltaTime","int",4]],"referenceCount"]]},mfhd:{struct:[["version","int",1],["flags","int",3],["sequenceNumber","int",4]]},tfma:{struct:[["version","int",1],["flags","int",3],["entryCount","int",4],["segmentDuration","int",4,"or",8],["mediaTime","int",4,"or",8],["mediaRateInteger","int",2],["mediaRateFraction","int",2]]},tfdt:{struct:[["version","int",1],["flags","int",3],["baseMediaDecodeTime","int",4,"or",8]]},tfra:{struct:[["version","int",1],["flags","int",3],["entryCount","int",4],["chunkOffsets",["int",4],"entryCount"]]},mfro:{struct:[["version","int",1],["flags","int",3],["entryCount","int",4],["chunkOffsets",["int",4],"entryCount"]]},isom:{container:!0},moov:{container:!0},mvex:{container:!0},mdia:{container:!0},traf:{container:!0},edts:{container:!0},udta:{container:!0},minf:{container:!0},trak:{container:!0},moof:{container:!0},dinf:{container:!0},stbl:{container:!0},mfra:{container:!0}}})}(this);