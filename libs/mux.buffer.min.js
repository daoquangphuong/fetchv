/*! Project Referenced from: https://github.com/videojs/mux.js/ | https://github.com/gpac/mp4box.js/ */
(t=>{let a={},e=null;class x{constructor(t){this.vId=Math.floor(1e8*Math.random()),this.sourceType=4,this.locked=!1,this.tracks=[],this.index={},this.size=0,this.isPreviewed=!1,this.isLive=!0,this.hasAltAudio=!1,this.mId=t,this.blobURL=null}updateQualityLabel(){let t="",e="";for(const i of this.tracks)i?.mimetype?.includes("video")&&(t=i.quality),i?.mimetype?.includes("audio")&&(e=i.quality);this.quality=t+(""!==t?" - ":"")+e}getTrackByType(t){return void 0===this.index[t]&&(this.index[t]=this.tracks.length,this.tracks.push({init:null,moofs:[],mdats:[],start:[],durations:[],duration:0,mimetype:t,quality:""})),this.tracks[this.index[t]]}getTrackByNumber(t){for(const e of this.tracks)if(e.init?.root?.moov?.trak?.tkhd?.trackID===t)return e;return null}clearAllTracks(){if(!M())for(const t of this.tracks)this.clearTrack(t)}clearTrack(t){t.moofs=[],t.mdats=[],t.start=[],t.durations=[],t.duration=0}get qualityLabel(){let t="",e="";for(const i of this.tracks)i.init&&(i.mimetype.includes("video")&&(t=i.quality),i.mimetype.includes("audio")&&(e=i.quality));return t+(""!==t?" - ":"")+e}assign(t){for(const e in t)this[e]=t[e]}}class Y{constructor(t){if(!M())if(t){if("undefined"!=typeof Buffer&&t instanceof Buffer)this.data=new Uint8Array(t);else if(t instanceof Uint8Array==!1)throw new Error("Data Error")}else this.data=new Uint8Array(0);this.data=t,this.rootBox=null,this.data?this.parse():this.root=new et("isom")}parse(){const e=new tt(this.data),s=t=>{var i=e.analyze(t);if(i){var r=new et(i,t,e.getPos());if(this.root||(this.root=r),i.container){r.setData(e.copy(8),i.size);for(let t=0,e=i.children;t<e;t++)s(r)}else r.setDataAndSync(e.copy(i.size))}};s(null)}get root(){return this.rootBox}set root(t){this.rootBox=t}size(){if(!this.root)return 0;const s=t=>{let e,i=t.children.length,r=t.size();for(e=0;e<i;e++)r+=s(t.children[e]);return r};return s(this.root)}tree(n,t){if(!this.root)return(n||console.log)("no box found");const o="                                  ",a=(i,r)=>{var e=(i.offset+o).substr(0,10)+"| "+o.substr(0,2*r)+"+"+i.type+" / "+i.size()+(i.container?" ( total "+i.wholeSize+" ) ":"")+(i.id?" , ID:"+i.id:"");if((n||console.log)(e),t)for(const s in i)if(!("function"==typeof i[s]||i[s]instanceof et||et.ignore[s])){let t=i[s];if(i[s]instanceof Array){if(i[s][0]instanceof et)continue;t=JSON.stringify(i[s].slice(0,10)),10<i[s].length&&(t+=" ...")}e="          | "+o.substr(0,2*r)+"  > "+s+" : "+t,(n||console.log)(e)}for(let t=0,e=i.children.length;t<e;t++)a(i.children[t],r+1)};a(this.root,0)}publish(e,i){if(!this.root)throw new Error("no rootbox found");const o=this.size(),a=new tt(new Uint8Array(o)),l=(r,s)=>{let n=r.children.length;r.publish(a,t=>{e(Math.floor(100*t/o))},t=>{const i=e=>{e<n?l(r.children[e],t=>{i(e+1)}):s(null)};i(0)})};l(this.root,t=>{i(t,a.data)})}async publishAsync(){return new Promise((t,e)=>{if(!this.root)return e("no rootbox found");e=this.size();const n=new tt(new Uint8Array(e)),o=(i,r)=>{let s=i.children.length;i.publish(n,null,()=>{const e=t=>{t<s?o(i.children[t],()=>{e(t+1)}):r()};e(0)})};o(this.root,()=>{t(n.data)})})}async clone(){var t=await this.publishAsync();return new Y(t)}static get Box(){return et}}class tt{constructor(t){this.ptr=0,this.data=t}read8(){return this.data[this.ptr++]}read16(){return this.data[this.ptr++]<<8|this.data[this.ptr++]}read24(){return this.data[this.ptr++]<<16|this.data[this.ptr++]<<8|this.data[this.ptr++]}read32(){return this.data[this.ptr++]<<24|this.data[this.ptr++]<<16|this.data[this.ptr++]<<8|this.data[this.ptr++]}read64(){return 4294967296*this.read32()+this.read32()}readText(e){let i="";for(let t=0;t<e;t++){var r=this.data[this.ptr++];i+=String.fromCharCode(r)}return i}readTextAsNullTermination(){var t=this.data.length;let e="";for(;this.ptr<t;){var i=this.data[this.ptr++];if(0===i)break;e+=String.fromCharCode(i)}return e}readUint8Array(e,i,r){for(let t=0;t<r;t++)e[i++]=this.data[this.ptr++]}write8(t){return this.data[this.ptr++]=255&t,this}write16(t){return this.data[this.ptr++]=t>>8&255,this.data[this.ptr++]=255&t,this}write24(t){return this.data[this.ptr++]=t>>16&255,this.data[this.ptr++]=t>>8&255,this.data[this.ptr++]=255&t,this}write32(t){return this.data[this.ptr++]=t>>24&255,this.data[this.ptr++]=t>>16&255,this.data[this.ptr++]=t>>8&255,this.data[this.ptr++]=255&t,this}write64(t){return this.write32(Math.floor(t/4294967296)),this.write32(Math.floor(t%4294967296)),this}writeText(i,r){for(let t=0,e=r=r||i.length;t<e;t++)this.data[this.ptr++]=i.charCodeAt(t);return this}writeTextAsNullTermination(t){return this.writeText(t),this.data[this.ptr++]=0,this}writeUint8Array(e,i,r){if(r<512)for(let t=0;t<r;t++)this.data[this.ptr++]=e[i++];else this.data.set(e.subarray(i,i+r),this.ptr),this.ptr+=r;return this}fill(e,i){i=i||0;for(let t=0;t<e;t++)this.data[this.ptr++]=i;return this}getPos(){return this.ptr}setPos(t){return this.ptr=t,this}skip(t){return this.ptr+=t,this}ready(){return this.ptr<this.data.length}copy(t){var e=this.data.subarray(this.ptr,this.ptr+t);return this.ptr+=t,this.ptr<0?new Uint8Array(e):e}toUint8Array(){return this.data}analyze(t){let i=null,e=this.ptr,r,s;var n=t=>!!t.match(/^[a-zA-Z0-9\u00a9]{4}$/),o=(t?(r=this.read32(),"mdat"===(s=this.readText(4))&&1===r&&(r=this.read32()<<32|this.read32())):(r=this.data.length+8,s="isom",e-=8),e+r);if(o<=this.data.length&&n(s)){i={size:r-(t?0:8),type:s,container:!1,children:0};let e=8;for(;e<r;){let t=this.read32();var a=this.readText(4);if("mdat"===a&&1===t&&(t=this.read32()<<32|this.read32(),this.skip(-8)),!n(a))break;if(t<8)break;this.skip(t-8),e+=t,i.children++}r===e&&(i.container=!0)}return this.ptr=e,i}}class et{constructor(t,e,i){if(!t)throw new Error("Mp4Box Error");if("string"==typeof t){if(this.property=a[t],!this.property)throw new Error(t+" type is not supported");this.boxInfo={type:t,container:this.property.container}}else{if(!t.type)throw new Error("Box info type is necessary");this.boxInfo=t,this.property=a[t.type]}this.type=this.boxInfo.type,this.container=this.boxInfo.container||this.property&&this.property.container||!1,this.setData(new Uint8Array(0),0),this.offset=null!==i&&0<i?i:0,this.id=null,this.parent=e,this.children=[],this.parent&&this.parent.appendChild(this),this.wholeSize=0}setData(t,e){this.data=t,this.buffer=new tt(t),e&&(this.wholeSize=e)}setDataAndSync(t,e){this.setData(t,e),this.sync(1)}size(){return this.container?"isom"===this.type?0:8:this.wholeSize||this.data&&this.data.length}sync(t){var e=this.property&&this.property.struct||this.boxInfo.struct,i=this.property&&this.property.minLength||this.boxInfo.minLength;if(!e)return 0;if(0!==t&&1!==t&&2!==t)return 0;if(0!==t){if(this.buffer.data.length<8)return 0;this.buffer.setPos(8)}return this.recursiveProc({mode:t,struct:e,minLength:i},this,0)+8}calcLength(e,i,t){var r=typeof e;if(i=0<i?i:1,"number"==r)return e;if("string"!=r)return 0;if("end"==e)return Math.floor((this.size()-this.buffer.getPos())/i);{r=e.match(/(\w+)([\-\+\*\/\d]*)/);let t=this[r[1]]||0;i=r[2]&&r[2][0];return i&&(e=Number(r[2].substr(1)),"-"===i&&(t-=e),"+"===i&&(t+=e),"*"===i&&(t*=e),"/"===i&&(t/=e)),t}}recursiveProc(t,r,s){var{mode:n,struct:i,minLength:o}=t;let a=0;for(let e=0,t=i.length;e<t;e++){var l=i[e][0],d=i[e][1];let t=i[e][2];var h=i[e][3],f=i[e][4];if(null===h||(this.version&&0<this.version&&"or"===h&&(t=f),!this.flags||"if"!==h||0!=(this.flags&f))){if(1===n&&!this.buffer.ready())break;if(2===n&&void 0===r[l])break;if(0===n&&o&&o<=a&&void 0===r[l])break;if("int"===d)1===t?(1===n?r[l]=this.buffer.read8():2===n&&this.buffer.write8(r[l]),a+=1):2===t?(1===n?r[l]=this.buffer.read16():2===n&&this.buffer.write16(r[l]),a+=2):3===t?(1===n?r[l]=this.buffer.read24():2===n&&this.buffer.write24(r[l]),a+=3):4===t?(1===n?r[l]=this.buffer.read32():2===n&&this.buffer.write32(r[l]),a+=4):8===t&&(1===n?r[l]=this.buffer.read64():2===n&&this.buffer.write64(r[l]),a+=8);else if("skip"===d){h=this.calcLength(t,1);1===n?(r[l]="("+h+")bytes",this.buffer.skip(h)):2===n&&this.buffer.fill(h,0),a+=h}else if("text"===d){f=this.calcLength(t,1);0<f?(1===n?r[l]=this.buffer.readText(f):2===n&&this.buffer.writeText(r[l],f),a+=f):(1===n?r[l]=this.buffer.readTextAsNullTermination():2===n&&this.buffer.writeTextAsNullTermination(r[l]),r[l]&&(a+=r[l].length+1))}else if(d instanceof Array&&((1===n||0===n&&void 0===r[l])&&(r[l]=[]),0<d.length)){var m=d[0]instanceof Array;let i=0;if(m)for(let t=0,e=d[0].length;t<e;t++)i+=d[0][t][2];else i=d[1];var u,c=0===n?r[l].length:this.calcLength(t,i);for(let t=0;t<c;t++)m?(u=1===n?{}:r[l][t])&&(a+=this.recursiveProc({mode:n,struct:d,minLength:o},u,s+1),1===n&&r[l].push(u)):a+=this.recursiveProc({mode:n,struct:[[t,d[0],d[1]]],minLength:o},r[l],s+1)}0===s&&r[l]}}return a}hasChild(i){for(let t=0,e=this.children.length;t<e;t++)if(this.children[t]===i)return t;return-1}append(t){return this.appendChild(t)}appendChild(e){if(e){if(-1===this.hasChild(e)){this.children.push(e);let t=this[e.type+"s"];(t=t||[]).push(e),this[e.type+"s"]=t,this[e.type]=t[0]}e.parent=this}}remove(t){return this.removeChild(t)}removeChild(t){var e,i;t&&(-1!==(e=this.hasChild(t))&&(this.children.splice(e,1),(e=this[t.type+"s"])?(0<=(i=e.indexOf(t))&&e.splice(i,1),0<e.length?this[t.type]=e[0]:(delete this[t.type+"s"],delete this[t.type])):delete this[t.type]),t.parent=null)}find(t){const s=i=>{if(i.type===t)return i;for(let t=0,e=i.children.length;t<e;t++){var r=s(i.children[t]);if(r)return r}return null};return s(this)}findAll(t){const s=(i,r)=>{i.type===t&&r.push(i);for(let t=0,e=i.children.length;t<e;t++)s(i.children[t],r);return r};return s(this,[])}arrange(){const s=i=>{var t=i.sync(0)||i.size();"mdat"!==i.type&&t!==i.data.length&&i.setData(new Uint8Array(t)),i.sync(2);let r=i.offset+t;for(let t=0,e=i.children.length;t<e;t++)i.children[t].offset=r,r+=s(i.children[t]);return i.wholeSize=r-i.offset,i.buffer.setPos(0),i.buffer.write32(i.wholeSize),i.buffer.writeText(i.type,4),i.wholeSize};return s(this)}publish(t,e,i){var r=this.sync(0),r=(0<r&&r>this.data.length&&this.setData(new Uint8Array(r)),this.sync(2),this.size());0<r&&t&&t.writeUint8Array(this.data,0,r),i(null)}publishToFile(t,e,i){var r=this.sync(0),r=(0<r&&r>this.data.length&&this.setData(new Uint8Array(r)),this.sync(2),this.size());0<r&&t?t(this.type,(t,e)=>{e||t.write(new Blob([this.data])),i(null)}):i(null)}inspect(){return"Box : '"+this.type+"' [ "+(this.container?"container":"prop")+" ] / "+this.size()}dump(){var t,e="";for(t in this)"function"!=typeof this[t]&&(e+=t+":"+this[t]+" , ");return e}static create(i,t,r){var s={};if(s.type=i,s.struct=t||a[i].struct,s.struct||r instanceof Uint8Array){var n=new et(s);if(s.struct){n.setData(new Uint8Array(0));for(let t=0,e=s.struct.length;t<e;t++){var o=s.struct[t][0];const i=s.struct[t][1];n[o]=r&&r[o]||(i instanceof Array?[]:"text"===i?"":0)}}else n.setDataAndSync(r);return n}return null}static get ignore(){return{type:1,container:1,data:1,buffer:1,offset:1,id:1,parent:1,children:1,wholeSize:1,boxInfo:1,property:1}}}function S(t){var i=t.root;if(i.moov){var e=i.moov.traks.length;if(1<e&&i.moov.mvex.trexs.length===e){var r=[];for(let t=0;t<e;t++){var s=new Y,n=s.root;i.ftyp&&n.append(i.ftyp),n.append(new Y.Box("moov")),n.moov.append(i.moov.mvhd),n.moov.append(new Y.Box("mvex")),n.moov.mvex.append(i.moov.mvex.trexs[t]),n.moov.append(i.moov.traks[t]),n.arrange(),r.push(s)}return r}}else if(i.moof){var o=t.data,a=i.moof.trafs.length;if(1<a){var l=[];for(let t=0;t<a;t++){var d=new Y,h=d.root,f=(i.styp&&h.append(i.styp),i.sidx&&h.append(i.sidx),h.append(new Y.Box("moof")),h.moof.append(i.moof.mfhd),h.moof.append(i.moof.trafs[t]),h.arrange(),h.publish(null,null,()=>{}),l.push(d),[]);let e=0;for(const u of i.moof.trafs[t].truns){var m=i.moof.offset+u.dataOffset;let t=0;for(const c of u.samples)t+=c.size;f.push(o.slice(m,m+t)),e+=t}h=new Uint8Array(8);e+=8,h.set([e>>24&255,e>>16&255,e>>8&255,255&e,109,100,97,116]),d.mdat=new Blob([h,...f]),d.isDivided=!0}return l}}return[t]}async function it(t){return new Promise((e,i)=>{const r=new FileReader;r.onload=t=>{e(r.result)},r.onerror=t=>{i(r.error)},r.readAsArrayBuffer(t)})}function M(){try{return e!==_byl}catch(t){return!0}}async function n(g,t){if(!g||0===g.length)throw new Error("Video is empty");let e=0;for(let t=0;t<g.length;t++)g[t].mimetype.includes("video")&&(e=t);2===g.length&&1===e&&(g=[g[1],g[0]],e=0);var{keyFrameComplement:y,modifyESDSTrackConfig:v,over4G:w}=t,s=[];for(let r=0,t=g.length;r<t;r++){var n=g[r];let i=0;for(let t=0,e=n.mdats.length;t<e;t++)void 0!==n.start[t]&&(s.push({track:r,num:t,order:i,start:n.start[t]}),i++)}s.sort((t,e)=>t.start-e.start);for(const m of g)m.mdats[0]&&9===m.mdats[0].size&&(m.mdats=[]);var i=[];const k=[];for(const u of g){let t;t=u.init&&u.init.data?u.init.data.length<2e4?new Y(u.init.data.slice()):u.init:await u.init.clone(),i.push(t),k.push(t.root)}for(let t=0,e=k.length;t<e;t++){var r=k[t],o=(r.moov.mvhd.version=r.moov.trak.tkhd.version=r.moov.trak.mdia.mdhd.version=0,r.moov.trak.tkhd.flags=3,t+1);if(r.moov.trak.tkhd.trackID=r.moov.mvex.trex.trackID=o,r.ftyp&&(r.ftyp.majorBrand="mp42",r.ftyp.minorVersion=0,r.ftyp.compatibleBrands=["isom","iso2","avc1","mp41","mp42"]),v){var o=r.moov.trak.mdia.minf.stbl.stsd,a=new tt(o.data),q=(a.skip(12),a.read32());for(let t=0;t<q;t++){var F=a.read32();if("mp4a"===a.readText(4)){a.skip(28);var N=a.getPos(),l=a.read32();if("esds"===a.readText(4)){a.skip(5);var j=a.read8(),E=(a.skip(4),a.read8()),V=(a.skip(14),a.read8());if(4===V){var _=a.read8(),Q=a.read8(),G=(a.skip(2),[]);for(let t=0,e=l-38;t<e;t++)G.push(a.read8());a.setPos(N),a.write32(l),a.skip(9),a.write8(j-2),a.skip(4),a.write8(E-2),a.skip(14),a.write8(V-2),a.write8(16+(7&_)),a.write8(248&Q);for(const K of G)a.write8(K);a.write16(0)}}else a.skip(l-8)}else a.skip(F-8)}}}var t=new Y,d=t.root;d.append(k[e].ftyp),d.append(new Y.Box("moov")),d.moov.append(k[e].moov.mvhd);for(const W of k)d.moov.append(W.moov.trak);d.moov.mvhd.nextTrackID=i.length+1;for(let t=d.moov.mvhd.creationTime=d.moov.mvhd.modificationTime=0,e=i.length;t<e;t++)d.moov.traks[t].tkhd.creationTime=d.moov.traks[t].mdia.mdhd.creationTime=d.moov.traks[t].tkhd.modificationTime=d.moov.traks[t].mdia.mdhd.modificationTime=0;var h=await(async(t,e)=>{var i=[{type:"vide",length:0,moofs:[],hasBaseMediaDecodeTime:!1},{type:"soun",length:0,moofs:[],hasBaseMediaDecodeTime:!1}];for(const s of i)for(const h of t)h.mdia.hdlr.handlerType===s.type&&Object.assign(s,{trackID:h.tkhd.trackID,timeScale:h.mdia.mdhd.timeScale,length:e[h.tkhd.trackID-1].moofs.length});var r=Math.max(i[0].length,i[1].length);for(let s=0;s<r;s++)for(let r=0;r<2;r++){var n=i[r],o=e[n.trackID-1]?.moofs[s];if(o){var a,l=(o instanceof Y?o:o instanceof et?{root:{moof:o}}:new Y(new Uint8Array(await it(o)))).root.moof.traf,o=l.tfdt.baseMediaDecodeTime<-2147483648?0:l.tfdt.baseMediaDecodeTime,o=(o+=(4294967295&o)<0?4294967296:0)/n.timeScale;let t=!1,e=(0<s&&(n.moofs[s-1].empty||({baseMediaDecodeTime:d,duration:a}=n.moofs[s-1],o<d||d+2*a<o))&&(t=!0),0),i=0;for(const f of l.truns){f.samples=f.samples||new Array(f.sampleCount||0).fill({});for(const m of f.samples||[])e+=m.duration||l.tfhd?.defaultSampleDuration||k[r].moov?.mvex?.trex?.sampleDuration||0,33554432&m.flags&&i++}e/=n.timeScale;var d=(l.trun?.samples?.[0]?.compositionTimeOffset||0)/n.timeScale;n.moofs[s]={baseMediaDecodeTime:o,compositionTimeOffset:d,duration:e,keyFrames:i,discontig:t},0<o&&(n.hasBaseMediaDecodeTime=!0)}else n.moofs[s]={empty:!0,baseMediaDecodeTime:0,duration:0}}return i})(d.moov.traks,g),H=function(i){var r=[[],[]];if(!(1<i[0].length&&!i[0].hasBaseMediaDecodeTime||1<i[1].length&&!i[1].hasBaseMediaDecodeTime)){var s=[0,0],n=[0,0];for(let t=i[0].elstPadding=i[1].elstPadding=0,e=Math.max(i[0].length,i[1].length);t<e;t++){var o,a,l,d=i[0].moofs[t],h=i[1].moofs[t];d&&h&&(d.empty&&(d.baseMediaDecodeTime=n[0]-s[0],i[d.duration=0].moofs[t+1]&&!i[0].moofs[t+1].empty&&(i[0].moofs[t+1].discontig=!0)),h.empty&&(h.baseMediaDecodeTime=n[1]-s[1],h.duration=0,i[1].moofs[t+1]&&!i[1].moofs[t+1].empty&&(i[1].moofs[t+1].discontig=!0)),0===t?(o=0<(a=d.baseMediaDecodeTime-h.baseMediaDecodeTime)?0:1,.01<(a=Math.abs(a))&&(l=i[o].moofs?.[0]?.compositionTimeOffset||0,r[o].push({segmentDuration:Math.floor(1e3*(a+l)),mediaTime:-1,mediaRateInteger:1,mediaRateFraction:0})),i[o].elstPadding=a,s[0]=s[1]=-Math.min(h.baseMediaDecodeTime,d.baseMediaDecodeTime)):d.discontig&&h.discontig?0<=(l=d.baseMediaDecodeTime-h.baseMediaDecodeTime-(n[0]-n[1]))?(s[0]=n[0]+l-d.baseMediaDecodeTime,s[1]=n[1]-h.baseMediaDecodeTime):(s[0]=n[0]-d.baseMediaDecodeTime,s[1]=n[1]-l-h.baseMediaDecodeTime):d.discontig?s[0]=n[0]-d.baseMediaDecodeTime:h.discontig&&(s[1]=n[1]-h.baseMediaDecodeTime),d.baseMediaDecodeTime+=s[0],h.baseMediaDecodeTime+=s[1],n[0]=d.baseMediaDecodeTime+d.duration,n[1]=h.baseMediaDecodeTime+h.duration)}for(let t=0;t<2;t++){var e=i[t],f=Math.floor(1e3*(n[t]-e.elstPadding))||123456789,m=e.moofs?.[0]?.compositionTimeOffset||0,m=Math.floor(m*e.timeScale)||0;r[t].push({segmentDuration:f,mediaTime:m,mediaRateInteger:1,mediaRateFraction:0})}}return r}(h);let J=[{},{}];try{localStorage.nosync||(J=await function(i){var r=[{},{}];if(1<i[0].length&&!i[0].hasBaseMediaDecodeTime||1<i[1].length&&!i[1].hasBaseMediaDecodeTime)return r;var s=[0,0];let t=!1;i[0].duration=i[1].duration=0,i[0].original_duration=i[1].original_duration=0;var n,o,a=Math.max(i[0].length,i[1].length);for(let e=0;e<a;e++){for(let t=0;t<2;t++)i[t].moofs[e].empty||(e<a-2-1&&((n=i[t].duration-(i[t].moofs[e].baseMediaDecodeTime-i[t].elstPadding+0))<-.05?(s[t]++,2<=s[t]&&(r[t][e+1]=Math.floor(n*i[t].timeScale),i[t].duration-=n,s[t]=0)):s[t]=0),i[t].original_duration+=i[t].moofs[e].duration,i[t].duration+=i[t].moofs[e].duration);e===a-2-2&&(o=i[0].original_duration-i[1].original_duration,Math.abs(o)<.1&&(t=!0))}return t?[{},{}]:r}(h))}catch(t){console.log(t.stack||t.message||t)}let b=0;for(const P of d.moov.traks){var D=P.mdia.minf.stbl,T=P.tkhd.trackID,x=P.mdia.hdlr.handlerType;"soun"===x&&(P.tkhd.alternateGroup=1,P.tkhd.volume=256);let{stsz:a,stts:i,stsc:r,stss:s,stco:t,ctts:n,sdtp:o,co64:e}=D,l=(a||D.append(a=Y.Box.create("stsz")),i||D.append(i=Y.Box.create("stts")),r||D.append(r=Y.Box.create("stsc")),s||D.append(s=Y.Box.create("stss")),o=o||Y.Box.create("sdtp"),n=n||Y.Box.create("ctts"),w?(e||D.append(e=Y.Box.create("co64")),t&&(D.remove(t),t=null)):(t||D.append(t=Y.Box.create("stco")),e&&(D.remove(e),e=null)),a.sampleSizes=[],i.entries=[],r.entries=[],s.syncSamples=[],o.sampleDependencies=[],n.entries=[],0),d=0,h=0,f=0,m=0,u=-1,c=0,p=0;var S=[];let v=0;for(const L of g[T-1].moofs)if(L){var M=L instanceof Y?L:L instanceof et?{root:{moof:L}}:new Y(new Uint8Array(await it(L))),Z=M.root.moof,C=(M.root.mdat&&g[T-1].mdats.push(new Blob([M.root.mdat.data])),Z.traf),z=C.tfhd,I=k[T-1].moov.mvex&&k[T-1].moov.mvex.trex;d++;let t=0,e=0;p+=J[T-1][d]||0;for(const R of C.truns){R.samples=R.samples||new Array(R.sampleCount||0).fill({});for(const X of R.samples){var A,B=Object.assign({},X);l++,B.duration=B.duration||z&&z.defaultSampleDuration||I&&I.sampleDuration||0,B.size=B.size||z&&z.defaultSampleSize||I&&I.sampleSize||0,B.flags=B.flags||z&&z.defaultSampleFlags||I&&I.sampleFlags||0,0!==(p=Math.floor(p))&&("vide"===x?(A=0<p?Math.min(B.duration-1,p):p,B.duration-=A,p-=A):"soun"===x&&p<0&&B.duration<-p&&(t++,m++,v+=B.duration,a.sampleSizes.push(0),p+=B.duration)),y&&0===e&&S.push(l),e++,0<(33554432&B.flags)&&"soun"!==x&&s.syncSamples.push(l),a.sampleSizes.push(B.size),f!==B.duration&&(0<m&&(i.entries.push({sampleCount:m,sampleDuration:f}),m=0),f=B.duration),m++,v+=B.duration,0<(2048&R.flags)&&(u!==B.compositionTimeOffset&&0<c&&(n.entries.push({sampleCount:c,sampleOffset:u}),c=0),u=B.compositionTimeOffset,c++)}t+=R.sampleCount,C.sdtp&&o.sampleDependencies.push(...C.sdtp.sampleDependencies)}h!==t&&(h=t,r.entries.push({firstChunk:d,samplesPerChunk:h,sampleDescriptionIndex:1})),d%100==0&&await async function(i){return new Promise((t,e)=>{setTimeout(t,i)})}(1)}i.entries.push({sampleCount:m,sampleDuration:f}),-1!==u&&n.entries.push({sampleCount:c,sampleOffset:u}),"vide"===x&&s.syncSamples.length<1+Math.floor(.8*d)&&((U=function(){var i=[];let t=0;for(const n of a.sampleSizes)t+=n;var r=t/a.sampleSizes.length;t=0;for(const o of a.sampleSizes){var e=o-r;t+=e*e}var s=Math.sqrt(t/a.sampleSizes.length);for(let t=0,e=a.sampleSizes.length;t<e;t++)3<(a.sampleSizes[t]-r)/s&&i.push(t+1);return i}()).length>s.syncSamples.length?s.syncSamples=U:y&&S.length>s.syncSamples.length&&(s.syncSamples=S),0===s.syncSamples.length&&(s.syncSamples=[1])),a.sampleCount=a.sampleSizes.length,i.entryCount=i.entries.length,r.entryCount=r.entries.length,s.entryCount=s.syncSamples.length,w?(e.entryCount=d,e.chunkOffsets=new Array(d)):(t.entryCount=d,t.chunkOffsets=new Array(d)),n.entries.length&&(n.entryCount=n.entries.length,"soun"!==x&&D.append(n)),P.mdia.mdhd.duration=v,P.tkhd.duration=Math.floor(v/P.mdia.mdhd.timeScale*1e3),P.edts||P.append(new Y.Box("edts")),P.edts.elst||P.edts.append(Y.Box.create("elst"));var U=0<n.entryCount?n.entries[0].sampleOffset:0,O=H[T-1]||[];0<O.length?(P.edts.elst.entryCount=O.length,P.edts.elst.entries=O):(P.edts.elst.entryCount=1,P.edts.elst.entries=[{segmentDuration:P.tkhd.duration,mediaTime:U,mediaRateInteger:1,mediaRateFraction:0}]),o.sampleDependencies.length&&D.append(o),P.mdia.mdhd.duration=v,b=Math.max(v/P.mdia.mdhd.timeScale,b)}h=Math.floor(1e3*b);d.moov.mvhd.timeScale=1e3,d.moov.mvhd.duration=h,d.arrange();let f=t.size();for(const c of s)w?d.moov.traks[c.track].mdia.minf.stbl.co64.chunkOffsets[c.order]=f+8:d.moov.traks[c.track].mdia.minf.stbl.stco.chunkOffsets[c.order]=f+8,f+=g[c.track].mdats[c.num].size;var $=[new Blob([await t.publishAsync()])];for(const p of s)$.push(g[p.track].mdats[p.num]);return new Blob($,{type:"appplication/octet-stream"})}async function r(t){var e=(t.isLive&&t.hasAltAudio?function(r){let t=0;for(const m of r){var e=m.start.length;0<e&&m.start[e-1]>t&&(t=m.start[e-1])}let s=t;for(const u of r)0<u.start.length&&u.start[0]<s&&(s=u.start[0]);var n=[];for(const c of r){var{mimetype:i,init:o}=c;n.push({mimetype:i,init:o,moofs:[],mdats:[],start:[]})}for(let i=s;i<=t;i++){var a=[];for(let t=0,e=r.length;t<e;t++){var l=r[t].start.indexOf(i);-1!==l&&a.push(l)}if(a.length===r.length)for(let t=0,e=r.length;t<e;t++){var d=r[t],h=a[t],f=n[t];f.moofs.push(d.moofs[h]),f.mdats.push(d.mdats[h]),f.start.push(d.start[h])}}return n}:function(t){var e=[];for(const a of t){var i,r,s,n,o;a.init&&0<a.moofs.length&&(i=a.moofs.slice(0),r=a.mdats.slice(0),s=a.start.slice(0),{mimetype:n,init:o}=a,e.push({mimetype:n,init:o,moofs:i,mdats:r,start:s}))}return e})(t.tracks),{size:t,sourceType:i}=t;if(0===e.length||0===e[0].moofs.length)return null;var r={};r.keyFrameComplement=4===i,r.modifyESDSTrackConfig=4===i,r.over4G=4e9<t;try{var s=await n(e,r);return URL.createObjectURL(s)}catch(t){return console.log(t),null}}function C(e,i,r){if(e&&i){r=r||0;var s=i&&i.moofs&&i.moofs[r],i=i&&i.sidx;if(i){var{timeScale:n,earliestPresentationTime:o}=i;let t;Math.abs(s.traf.tfdt.baseMediaDecodeTime/e.root.moov.trak.mdia.mdhd.timeScale-o/n),o&&n?t=o/n:s.traf.tfdt.baseMediaDecodeTime&&e.root.moov.trak.mdia.mdhd.timeScale&&(t=s.traf.tfdt.baseMediaDecodeTime/e.root.moov.trak.mdia.mdhd.timeScale);o=i.references&&i.references[r]&&i.references[r].subsegmentDuration;if(n&&void 0!==t&&o)return{moofDuration:o/n,moofStart:t}}if(s&&e&&e.root&&e.root.moov){i=e.root.moov.trak.mdia.mdhd.timeScale,r=s.traf;if(r&&i){var{tfhd:o,trun:n,tfdt:s}=r;if(o&&s&&n){var s=s.baseMediaDecodeTime/i,a=o.defaultSampleDuration;if(n.samples){let t=0;for(const d of r.truns)for(const h of d.samples)t+=h.duration||a||0;if(0===t){var l=e.root.moov.mvex&&e.root.moov.mvex.trex&&e.root.moov.mvex.trex.sampleDuration||0;for(const f of r.truns)t+=(f.sampleCount||0)*l}return{moofDuration:t/=i,moofStart:s}}}}}}return{moofDuration:0,moofStart:0}}function z(t){let e=0;for(const i of t)i.init&&0<i.moofs.length&&e++;return t.length===e}function I(t,e){try{var i=t.root.moov.trak.tkhd,r=e.root.moov.trak.tkhd,s=function(e,i){var r=e.length;if(r!==i.length)return!1;for(let t=0;t<r;t++)if(e[t]!==i[t])return!1;return!0}(i.matrix,r.matrix)&&i.width===r.width&&i.height===r.height,n=t.root.moov.trak.mdia.mdhd,o=e.root.moov.trak.mdia.mdhd,a=n.timeScale===o.timeScale&&n.languageValues===o.languageValues,l=t.root.moov.trak.mdia.hdlr,d=e.root.moov.trak.mdia.hdlr,h=l.handlerType===d.handlerType&&l.name===d.name;return s&&a&&h}catch(t){return 1}}function A(t){t=t?.init?.root?.moov?.trak?.mdia;if(t){var e=t.mdhd?.timeScale;if(e)return e;if(t.hdlr){if("vide"===t.hdlr.handlerType)return 9e4;if("soun"===t.hdlr.handlerType)return 48e3}}return 1e3}function B(i){for(const e of i){var t;e.init&&1<e.moofs.length&&(t=e.moofs.length-1,e.start[t]===e.start[t-1]&&e.durations[t]===e.durations[t-1]&&(e.moofs.splice(t-1,1),e.mdats.splice(t-1,1),e.start.splice(t-1,1),e.durations.splice(t-1,1)))}if(2===i.length&&!(i[0].start.length<1||i[1].start.length<1)){var r,s=i[0],i=i[1];let t=null,e=Math.abs(s.start[0]-i.start[0]);1<s.start.length&&((r=Math.abs(s.start[1]-i.start[0]))<e&&(e=r,t=s)),1<i.start.length&&((r=Math.abs(i.start[1]-s.start[0]))<e&&(e=r,t=i)),t&&(t.moofs.splice(0,1),t.mdats.splice(0,1),t.start.splice(0,1),t.durations.splice(0,1))}}function U(t){for(const a of t){const l=a.start.length-1;if(2<=l){var{moofs:e,mdats:i,start:r,durations:s}=a;if(e.length===i.length&&e.length===r.length&&e.length===s.length&&r[l-2]<r[l]&&r[l]<r[l-1]){var n=r[l-2]+s[l-2];if(Math.abs(n-r[l])<Math.abs(n-r[l-1])){o=void 0;for(const d of[e,i,r,s]){var o=d[l-1];d[l-1]=d[l],d[l]=o}}}}}}function O(e){if(e&&e.start){var i=e.start.length;if(1<i)for(let t=e.contig;t<i-1;t++){var r=e.start[t],s=e.duration[t],n=e.start[t+1];if(.1<Math.abs(r+s-n))return 1;e.contig=t+1}}}async function P(i){return new Promise((e,t)=>{fetch(i).then(function(t){if(t.ok)return t.arrayBuffer();e(null)}).then(function(t){e(t)}).catch(function(t){e(null)})})}function i(){return{iods:{},stsd:{},stdp:{},mdat:{},stsh:{},vmhd:{},trun:{struct:[["version","int",1],["flags","int",3],["sampleCount","int",4],["dataOffset","int",4,"if",1],["firstSampleFlags","int",4,"if",4],["samples",[["duration","int",4,"if",256],["size","int",4,"if",512],["flags","int",4,"if",1024],["compositionTimeOffset","int",4,"if",2048]],"sampleCount"]]},tfhd:{minLength:8,struct:[["version","int",1],["flags","int",3],["trackID","int",4],["baseDataOffset","int",8,"if",1],["sampleDescriptionIndex","int",4,"if",2],["defaultSampleDuration","int",4,"if",8],["defaultSampleSize","int",4,"if",16],["defaultSampleFlags","int",4,"if",32],["emptyDuration","int",4],["iframeSwitching","int",1]]},smhd:{struct:[["version","int",1],["flags","int",3],["balance","int",2],["reserved","int",2]]},sdtp:{struct:[["version","int",1],["flags","int",3],["sampleDependencies",["int",4],"end"]]},stco:{struct:[["version","int",1],["flags","int",3],["entryCount","int",4],["chunkOffsets",["int",4],"entryCount"]]},hdlr:{struct:[["version","int",1],["flags","int",3],["preDefined","int",4],["handlerType","text",4],["reserved","skip",12],["name","text",0]]},elst:{struct:[["version","int",1],["flags","int",3],["entryCount","int",4],["entries",[["segmentDuration","int",4,"or",8],["mediaTime","int",4,"or",8],["mediaRateInteger","int",2],["mediaRateFraction","int",2]],"entryCount"]]},tkhd:{struct:[["version","int",1],["flags","int",3],["creationTime","int",4,"or",8],["modificationTime","int",4,"or",8],["trackID","int",4],["reserved1","int",4],["duration","int",4,"or",8],["reserved2","skip",8],["layer","int",2],["alternateGroup","int",2],["volume","int",2],["reserved3","int",2],["matrix",["int",4],9],["width","int",4],["height","int",4]]},mvhd:{struct:[["version","int",1],["flags","int",3],["creationTime","int",4,"or",8],["modificationTime","int",4,"or",8],["timeScale","int",4],["duration","int",4,"or",8],["rate","int",4],["volume","int",2],["reserved","skip",10],["matrix",["int",4],9],["preDefined","skip",24],["nextTrackID","int",4]]},ftyp:{struct:[["majorBrand","text",4],["minorVersion","int",4],["compatibleBrands",["text",4],"end"]]},mehd:{struct:[["version","int",1],["flags","int",3],["fragmentDuration","int",4,"or",8]]},trex:{struct:[["version","int",1],["flags","int",3],["trackID","int",4],["sampleDescriptionIndex","int",4],["sampleDuration","int",4],["sampleSize","int",4],["sampleFlags","int",4]]},trep:{struct:[["version","int",1],["flags","int",3],["trackID","int",4]]},mdhd:{struct:[["version","int",1],["flags","int",3],["creationTime","int",4,"or",8],["modificationTime","int",4,"or",8],["timeScale","int",4],["duration","int",4,"or",8],["languageValues","int",2],["QTQuality","int",2]]},dref:{struct:[["version","int",1],["flags","int",3],["entryCount","int",4],["entrySize","int",4],["typeText","text",4],["entryVersion","int",1],["entryFlags","int",3]]},stts:{struct:[["version","int",1],["flags","int",3],["entryCount","int",4],["entries",[["sampleCount","int",4],["sampleDuration","int",4]],"entryCount"]]},stss:{struct:[["version","int",1],["flags","int",3],["entryCount","int",4],["syncSamples",["int",4],"entryCount"]]},stsz:{struct:[["version","int",1],["flags","int",3],["sampleSize","int",4],["sampleCount","int",4],["sampleSizes",["int",4],"sampleCount"]]},stsc:{struct:[["version","int",1],["flags","int",3],["entryCount","int",4],["entries",[["firstChunk","int",4],["samplesPerChunk","int",4],["sampleDescriptionIndex","int",4]],"entryCount"]]},co64:{struct:[["version","int",1],["flags","int",3],["entryCount","int",4],["chunkOffsets",["int",8],"entryCount"]]},ctts:{struct:[["version","int",1],["flags","int",3],["entryCount","int",4],["entries",[["sampleCount","int",4],["sampleOffset","int",4]],"entryCount"]]},sidx:{struct:[["version","int",1],["flags","int",3],["referenceID","int",4],["timeScale","int",4],["earliestPresentationTime","int",4,"or",8],["firstOffset","int",4,"or",8],["reserved","int",2],["referenceCount","int",2],["references",[["subsegmentSize","int",4],["subsegmentDuration","int",4],["RAPDeltaTime","int",4]],"referenceCount"]]},mfhd:{struct:[["version","int",1],["flags","int",3],["sequenceNumber","int",4]]},tfma:{struct:[["version","int",1],["flags","int",3],["entryCount","int",4],["segmentDuration","int",4,"or",8],["mediaTime","int",4,"or",8],["mediaRateInteger","int",2],["mediaRateFraction","int",2]]},tfdt:{struct:[["version","int",1],["flags","int",3],["baseMediaDecodeTime","int",4,"or",8]]},tfra:{struct:[["version","int",1],["flags","int",3],["entryCount","int",4],["chunkOffsets",["int",4],"entryCount"]]},mfro:{struct:[["version","int",1],["flags","int",3],["entryCount","int",4],["chunkOffsets",["int",4],"entryCount"]]},isom:{container:!0},moov:{container:!0},mvex:{container:!0},mdia:{container:!0},traf:{container:!0},edts:{container:!0},udta:{container:!0},minf:{container:!0},trak:{container:!0},moof:{container:!0},dinf:{container:!0},stbl:{container:!0},mfra:{container:!0}}}Object.assign(t,{Manifest:class{constructor(t,e){this.id=Math.floor(1e8*Math.random()),this.name=t.title,this.downloadUI=e,this.status="normal",this.isReady=!1,this.size=0,this.video=null,this.hasQuality=!1,this.duration=0,this.mediaSourceId=null,this.isPreviewed=!1}load(){a=i(),e=btoa(encodeURI(location.host)).toLowerCase().replace(/=/g,"")}setInfo(){var t,e=this.video;e&&(t=this.getDuration(e),this.downloadUI.setInfo(t,e.size,e.quality))}async stop(){var t;"stop"!==this.status&&"error"!==this.status&&(this.status="stop",t=this.video,t=await this.flush(t),this.video=null,this.isPreviewed||(this.downloadUI.setPreview(t),this.isPreviewed=!0),t&&this.downloadUI.completed())}getDuration(t){var e=t.tracks;if(!(t.tracks.length<1)){let t=null;for(const i of e)i.mimetype.includes("video")&&(t=i.duration);return t=null===t?e[0].duration:t}}async flush(t,e=!0){if(!t.size)return null;var i=await r(t);if(!i)return this.status="error",this.downloadUI.error("500: video flush error"),null;if(e){e=this.getDuration(t);if(!e)return URL.revokeObjectURL(i),null;t=t.quality;this.downloadUI.createSaveBtn(i,e,t,this.name)}return i}async saveCurrent(){var t=await this.flush(this.video,!1);t&&this.downloadUI.saveCurrent(t,this.name)}async push(t){var{mimetype:e,mediasourceid:t,bufferid:r,url:i}=t;if(i){this.video||(this.video=new x(t));var s=this.video;if("stop"===this.status||"error"===this.status||s.locked)URL.revokeObjectURL(i);else if(s.mId!==t)this.stop(),URL.revokeObjectURL(i);else{var n=await P(i);if(URL.revokeObjectURL(i),n){this.isReady||(this.downloadUI.ready(this.name),this.isReady=!0);var{tracks:o,index:a}=s,l=S(new Y(new Uint8Array(n)));const k=M();let i=0;for(const b of l){var d=r+(1===l.length?"":l.indexOf(b)),h=b.root.moovs,f=b.root.moofs,m=b.root.mdats||b.mdat;void 0===a[d]&&(a[d]=o.length,o.push({init:null,moofs:[],mdats:[],start:[],durations:[],duration:0,contig:0,mimetype:e,quality:""}));const D=o[a[d]];var u=t=>{t=t||0;let{moofDuration:e,moofStart:i}=C(D.init,b.root,t);t=b.root.moofs[t];let r=i+Math.min(1e4,t.mfhd?.sequenceNumber||0)/1e8;return k&&(e++,i*=2,r+=10),D._prev={sequenceNumber:r,moofStart:i,moofDuration:e},{moof:t,sequenceNumber:r,moofStart:i,moofDuration:e}};if(h){if(D.init&&z(o)&&!I(D.init,b)){if(s.locked=!0,!await this.flush(s))return;this.downloadUI.splitResolution(),s.clearAllTracks(),s.size=0,s.locked=!1}D.init=b;h=D.init.root.moov.trak;h&&(h.tkhd.width?(D.quality=Math.floor(h.tkhd.width/65536+.4)+" x "+Math.floor(h.tkhd.height/65536+.4),D.mimetype="video"):(D.quality=h.mdia.mdhd.timeScale+" Hz",D.mimetype="audio")),this.video.updateQualityLabel()}if(f){if(b.root.moofs[0]&&b.root.moofs[0].traf&&b.root.moofs[0].traf.senc)return this.status="error",void this.downloadUI.error("502: Video is copyrighted");A(D);if(b.isDivided){var{sequenceNumber:h,moofDuration:c}=u();k||D.moofs.push(b),D.start.push(h),D.durations.push(c),D.duration+=c}else for(let t=0,e=b.root.moofs.length;t<e;t++){var{moof:p,sequenceNumber:v,moofDuration:g}=u(t),y=p.offset,p=y+p.wholeSize;-1===D.start.indexOf(v)&&(k||D.moofs.push(new Blob([n.slice(y,p)])),D.start.push(v),D.durations.push(g),D.duration+=g)}h=D.moofs.length;if(0===a[d]&&6e3<=h&&h%1e3==0||0===a[d]&&2791728742<this.size){if(s.locked=!0,!await this.flush(s))return;this.downloadUI.splitChunks(),s.clearAllTracks(),s.size=0,s.locked=!1}}if(m)if(b.isDivided)k||D.mdats.push(b.mdat),i+=b.mdat.size;else if(f&&b.root.moofs.length===b.root.mdats.length)for(let t=0,e=b.root.mdats.length;t<e;t++){var w=u(t)["sequenceNumber"],w=D.start.indexOf(w);-1===w||D.mdats[w]||(D.mdats[w]=new Blob([b.root.mdats[t].data]),i+=b.root.mdats[t].data.byteLength)}else for(const T of b.root.mdats)k||D.mdats.push(new Blob([T.data])),i+=T.data.byteLength;if(s.size=s.size+i,this.setInfo(),!this.isPreviewed&&3145728<=s.size){this.isPreviewed=!0;c=await this.flush(s,!1);if(!c)return;this.downloadUI.setPreview(c)}if(B(o),U(o),O(D)){if(s.locked=!0,!await this.flush(s))return;this.downloadUI.splitResolution(),s.clearAllTracks(),s.size=0,s.locked=!1}}}}}else this.stop()}}})})(this);